(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[822],{219:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(5155),l=r(2115),a=r(792),n=r(851);let o="https://ykqhrxwrngksghgqqcot.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlrcWhyeHdybmdrc2doZ3FxY290Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxMjI1MjEsImV4cCI6MjA2MDY5ODUyMX0.aQy24qeLeq0OLw6xLGWTAX44XUqbLpKpJ5QZevZ3R90";o&&c||console.warn("Supabase credentials missing. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables.");let i=(0,n.UU)(o,c);async function d(){try{let{error:e}=await i.from("crawl_sessions").select("count",{count:"exact"}).limit(1);if(e)return console.error("Supabase connection error:",e),!1;return!0}catch(e){return console.error("Failed to connect to Supabase:",e),!1}}let m=new(r(3290)).z4({apiKey:"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",dangerouslyAllowBrowser:!0});async function u(e){if(!e)return null;try{return(await m.embeddings.create({model:"text-embedding-ada-002",input:e.replace(/\n/g," ")})).data[0].embedding}catch(e){return console.error("Error generating embedding:",e),null}}async function h(e){try{let{data:t,error:r}=await i.from("crawl_sessions").insert({source_url:e.url,options:{maxLinks:e.maxLinks,crawlSubpages:e.crawlSubpages,llmFilter:e.llmFilter}}).select("id").single();if(r)throw Error("Error storing crawl session: ".concat(r.message));let s=t.id;for(let t of Array.isArray(e.pages)?e.pages:e.content?[{url:e.url,content:e.content}]:[]){let{data:e,error:r}=await i.from("pages").insert({crawl_id:s,url:t.url,title:t.title||"",content_text:t.content||"",content_json:t}).select("id").single();if(r){console.error("Error storing page ".concat(t.url,":"),r);continue}let l=e.id,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(!e)return[];let r=[],s=e.length/4,l=Math.floor(e.length/(s/t));for(let t=0;t<e.length;t+=l)r.push(e.slice(t,t+l));return r}(t.content||"");for(let e=0;e<a.length;e++){let r=a[e],s=Math.ceil(r.length/4),n=await u(r),{error:o}=await i.from("page_chunks").insert({page_id:l,chunk_index:e,content:r,token_count:s,embedding:n});o&&console.error("Error storing chunk ".concat(e," for page ").concat(t.url,":"),o)}if(t.links&&Array.isArray(t.links)&&t.links.length>0){let e=t.links.map(e=>({source_page_id:l,target_url:e.url,anchor_text:e.text||"",is_internal:e.url.startsWith(new URL(t.url).origin)})),{error:r}=await i.from("page_links").insert(e);r&&console.error("Error storing links for page ".concat(t.url,":"),r)}}return{success:!0,crawlId:s}}catch(e){throw console.error("Error storing crawl results:",e),e}}function x(){let[e,t]=(0,l.useState)(""),[r,n]=(0,l.useState)("1"),[o,c]=(0,l.useState)(10),[i,m]=(0,l.useState)(!0),[u,x]=(0,l.useState)(!0),[g,p]=(0,l.useState)(!1),[f,w]=(0,l.useState)(!1),[b,j]=(0,l.useState)(!1),[v,y]=(0,l.useState)(""),[N,k]=(0,l.useState)(null),[S,C]=(0,l.useState)(null),[L,_]=(0,l.useState)(null),[F,M]=(0,l.useState)(null),[E,U]=(0,l.useState)("");(0,l.useEffect)(()=>{!async function(){M(await d())}()},[]);let R=e=>{try{return new URL(e),U(""),!0}catch(e){return U("Please enter a valid URL (e.g., https://example.com)"),!1}},A=e=>e.trim().startsWith("#")||e.includes("![")||e.includes("](")||/\*\*.+\*\*/.test(e)||/\*.+\*/.test(e)||/\n\s*[-*+]\s/.test(e)||/\n\s*\d+\.\s/.test(e),I=e=>{try{let t=JSON.parse(e);return"object"==typeof t&&null!==t}catch(e){return!1}},O=async t=>{if(t.preventDefault(),y(""),C(null),_(null),k(null),R(e)){if(o<=0)return void y("Max pages must be greater than 0");w(!0);try{let t=new URL("https://markdowner.banana18nt.workers.dev");t.searchParams.append("url",e),t.searchParams.append("crawlSubpages",u?"true":"false"),t.searchParams.append("llmFilter",g?"true":"false"),t.searchParams.append("maxLinks",o.toString());let s={Authorization:"Bearer ".concat("WinWin0209")};"1"===r?(s.Accept="application/json",s["Content-type"]="application/json"):(s.Accept="text/markdown",s["Content-type"]="application/text");let l=await fetch(t.toString(),{method:"GET",headers:s});if(!l.ok)throw Error("API error: ".concat(l.status," ").concat(l.statusText));let a=l.headers.get("content-type")||"";console.log("Response content type:",a);let n=await l.text();if(console.log("Raw response text (first 100 chars):",n.substring(0,100)),I(n)){let e=JSON.parse(n);C(e),_("json"),console.log("Detected format: JSON")}else A(n)?(C(n),_("markdown"),console.log("Detected format: Markdown")):(C(n),_("markdown"),console.log("Detected format: Unknown (treating as text)"))}catch(e){console.error("Error fetching data:",e),y(e instanceof Error?e.message:"An unknown error occurred")}finally{w(!1)}}},J=async()=>{if(S){j(!0),k(null);try{let t={url:e,maxLinks:o,crawlSubpages:u,llmFilter:g,pages:"string"==typeof S?[{url:e,content:S,title:e}]:S.pages||[{url:e,content:JSON.stringify(S),title:e}]},{success:r,crawlId:s}=await h(t);r?(k(!0),console.log("Successfully saved crawl data with ID: ".concat(s))):(k(!1),y("Failed to save data to Supabase"))}catch(e){console.error("Error saving to Supabase:",e),k(!1),y(e instanceof Error?"Error saving to Supabase: ".concat(e.message):"An unknown error occurred while saving")}finally{j(!1)}}};return(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Web Crawler"}),(0,s.jsx)("div",{className:"bg-white shadow-sm rounded-lg p-6 mb-6",children:(0,s.jsx)("form",{onSubmit:O,children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"url",className:"block text-sm font-medium text-gray-700",children:"Website URL or Sitemap URL"}),(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsx)("input",{type:"text",name:"url",id:"url",value:e,onChange:e=>t(e.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border ".concat(E?"border-red-500":""),placeholder:"https://example.com",required:!0}),E&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"returnType",className:"block text-sm font-medium text-gray-700",children:"Preferred Data Format"}),(0,s.jsxs)("select",{id:"returnType",name:"returnType",value:r,onChange:e=>n(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[(0,s.jsx)("option",{value:"1",children:"JSON"}),(0,s.jsx)("option",{value:"2",children:"Markdown format"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"maxPages",className:"block text-sm font-medium text-gray-700",children:"Max Links to Crawl"}),(0,s.jsx)("input",{type:"number",name:"maxPages",id:"maxPages",value:o,onChange:e=>c(parseInt(e.target.value)),min:"1",className:"mt-1 shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"10"})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("fieldset",{children:[(0,s.jsx)("legend",{className:"text-sm font-medium text-gray-700",children:"Crawl Options"}),(0,s.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex items-center h-5",children:(0,s.jsx)("input",{id:"respectRobots",name:"respectRobots",type:"checkbox",checked:i,onChange:e=>m(e.target.checked),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"})}),(0,s.jsx)("div",{className:"ml-3 text-sm",children:(0,s.jsx)("label",{htmlFor:"respectRobots",className:"font-medium text-gray-700",children:"Respect robots.txt"})})]}),(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex items-center h-5",children:(0,s.jsx)("input",{id:"crawlSubpages",name:"crawlSubpages",type:"checkbox",checked:u,onChange:e=>x(e.target.checked),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"})}),(0,s.jsx)("div",{className:"ml-3 text-sm",children:(0,s.jsx)("label",{htmlFor:"crawlSubpages",className:"font-medium text-gray-700",children:"Crawl subpages"})})]}),(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex items-center h-5",children:(0,s.jsx)("input",{id:"llmFilter",name:"llmFilter",type:"checkbox",checked:g,onChange:e=>p(e.target.checked),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"})}),(0,s.jsx)("div",{className:"ml-3 text-sm",children:(0,s.jsx)("label",{htmlFor:"llmFilter",className:"font-medium text-gray-700",children:"Filter out unnecessary information using LLM"})})]})]})]})}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"submit",disabled:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white ".concat(f?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Crawling..."]}):"Start Crawling"})})]})})}),v&&(0,s.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)("p",{className:"text-sm text-red-700",children:v})})]})}),!0===N&&(0,s.jsx)("div",{className:"bg-green-50 border-l-4 border-green-400 p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)("p",{className:"text-sm text-green-700",children:"Successfully saved crawl results to Database!"})})]})}),S&&L&&"1"===r&&"markdown"===L&&(0,s.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,s.jsx)("strong",{children:"Note:"})," You requested JSON format, but the API returned Markdown content. Displaying as Markdown instead."]})})]})}),S&&(0,s.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Results"}),(0,s.jsx)("button",{onClick:J,disabled:b||!F,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md shadow-sm ".concat(F?b?"bg-green-400 cursor-not-allowed":"text-white bg-green-600 hover:bg-green-700":"bg-gray-300 cursor-not-allowed text-gray-500"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"),children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"-ml-0.5 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Save to DB for next process"]})})]}),"json"===L?(0,s.jsx)("div",{className:"bg-gray-50 p-4 rounded-md overflow-auto max-h-96",children:(0,s.jsx)("pre",{className:"text-sm text-gray-800",children:JSON.stringify(S,null,2)})}):(0,s.jsx)("div",{className:"bg-gray-50 p-4 rounded-md overflow-auto max-h-96",children:(0,s.jsx)("div",{className:"prose max-w-none",children:void 0!==a.oz?"string"==typeof S?(0,s.jsx)(a.oz,{children:S}):(0,s.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(S,null,2)}):(0,s.jsx)("pre",{className:"whitespace-pre-wrap",children:"string"==typeof S?S:JSON.stringify(S,null,2)})})}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsxs)("button",{onClick:()=>{let e=new Blob(["json"===L?JSON.stringify(S,null,2):"string"==typeof S?S:JSON.stringify(S,null,2)],{type:"json"===L?"application/json":"text/markdown"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="crawl-result.".concat("json"===L?"json":"md"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)},className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,s.jsx)("svg",{className:"-ml-0.5 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})})]})]})}},4984:(e,t,r)=>{Promise.resolve().then(r.bind(r,219))}},e=>{var t=t=>e(e.s=t);e.O(0,[411,728,441,684,358],()=>t(4984)),_N_E=e.O()}]);