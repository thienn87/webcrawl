(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[728],{182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version=void 0,t.version="0.0.0-automated"},851:(e,t,s)=>{"use strict";s.d(t,{UU:()=>tO});let r=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(s.bind(s,2410)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)};class n extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class i extends n{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class a extends n{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class o extends n{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(J||(J={}));class l{constructor(e,{headers:t={},customFetch:s,region:n=J.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=r(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s,r,n,l,h;return r=this,n=void 0,l=void 0,h=function*(){try{let r,n,{headers:l,method:h,body:c}=t,u={},{region:d}=t;d||(d=this.region),d&&"any"!==d&&(u["x-region"]=d),c&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)&&("undefined"!=typeof Blob&&c instanceof Blob||c instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",r=c):"string"==typeof c?(u["Content-Type"]="text/plain",r=c):"undefined"!=typeof FormData&&c instanceof FormData?r=c:(u["Content-Type"]="application/json",r=JSON.stringify(c)));let f=yield this.fetch(`${this.url}/${e}`,{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),l),body:r}).catch(e=>{throw new i(e)}),p=f.headers.get("x-relay-error");if(p&&"true"===p)throw new a(f);if(!f.ok)throw new o(f);let g=(null!=(s=f.headers.get("Content-Type"))?s:"text/plain").split(";")[0].trim();return{data:"application/json"===g?yield f.json():"application/octet-stream"===g?yield f.blob():"text/event-stream"===g?f:"multipart/form-data"===g?yield f.formData():yield f.text(),error:null}}catch(e){return{data:null,error:e}}},new(l||(l=Promise))(function(e,t){function s(e){try{a(h.next(e))}catch(e){t(e)}}function i(e){try{a(h.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):((r=t.value)instanceof l?r:new l(function(e){e(r)})).then(s,i)}a((h=h.apply(r,n||[])).next())})}}let{PostgrestClient:h,PostgrestQueryBuilder:c,PostgrestFilterBuilder:u,PostgrestTransformBuilder:d,PostgrestBuilder:f,PostgrestError:p}=s(5646),g={"X-Client-Info":"realtime-js/2.11.2"};!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(W||(W={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(H||(H={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(z||(z={})),(K||(K={})).websocket="websocket",function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(V||(V={}));class m{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):"string"==typeof e?t(JSON.parse(e)):t({})}_binaryDecode(e){let t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){let r=t.getUint8(1),n=t.getUint8(2),i=this.HEADER_LENGTH+2,a=s.decode(e.slice(i,i+r));i+=r;let o=s.decode(e.slice(i,i+n));return i+=n,{ref:null,topic:a,event:o,payload:JSON.parse(s.decode(e.slice(i,e.byteLength)))}}}class y{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(G||(G={}));let w=(e,t,s={})=>{var r;let n=null!=(r=s.skipTypes)?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=_(r,e,t,n),s),{})},_=(e,t,s,r)=>{let n=t.find(t=>t.name===e),i=null==n?void 0:n.type,a=s[e];return i&&!r.includes(i)?b(i,a):v(a)},b=(e,t)=>{if("_"===e.charAt(0))return E(t,e.slice(1,e.length));switch(e){case G.bool:return k(t);case G.float4:case G.float8:case G.int2:case G.int4:case G.int8:case G.numeric:case G.oid:return S(t);case G.json:case G.jsonb:return x(t);case G.timestamp:return A(t);case G.abstime:case G.date:case G.daterange:case G.int4range:case G.int8range:case G.money:case G.reltime:case G.text:case G.time:case G.timestamptz:case G.timetz:case G.tsrange:case G.tstzrange:default:return v(t)}},v=e=>e,k=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},S=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},x=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.log(`JSON parse error: ${e}`)}return e},E=(e,t)=>{if("string"!=typeof e)return e;let s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r,n=e.slice(1,s);try{r=JSON.parse("["+n+"]")}catch(e){r=n?n.split(","):[]}return r.map(e=>b(t,e))}return e},A=e=>"string"==typeof e?e.replace(" ","T"):e,T=e=>{let t=e;return(t=(t=t.replace(/^ws/i,"http")).replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,"")).replace(/\/+$/,"")};class P{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null==(s=this.receivedResp)?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(X||(X={}));class O{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{let{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=O.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=O.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{let{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=O.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){let n=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(n,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{let s=n[e];if(s){let r=t.map(e=>e.presence_ref),n=s.map(e=>e.presence_ref),i=t.filter(e=>0>n.indexOf(e.presence_ref)),l=s.filter(e=>0>r.indexOf(e.presence_ref));i.length>0&&(a[e]=i),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(n,{joins:a,leaves:o},s,r)}static syncDiff(e,t,s,r){let{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(n,(t,r)=>{var n;let i=null!=(n=e[t])?n:[];if(e[t]=this.cloneDeep(r),i.length>0){let s=e[t].map(e=>e.presence_ref),r=i.filter(e=>0>s.indexOf(e.presence_ref));e[t].unshift(...r)}s(t,i,r)}),this.map(i,(t,s)=>{let n=e[t];if(!n)return;let i=s.map(e=>e.presence_ref);n=n.filter(e=>0>i.indexOf(e.presence_ref)),e[t]=n,r(t,n,s),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,s)=>{let r=e[s];return"metas"in r?t[s]=r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Y||(Y={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(Q||(Q={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Z||(Z={}));class ${constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=H.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new P(this,z.join,this.params,this.timeout),this.rejoinTimer=new y(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=H.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=H.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this._on(z.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new O(this),this.broadcastEndpointURL=T(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:n,presence:i,private:a}}=this.params;this._onError(t=>null==e?void 0:e(Z.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Z.CLOSED));let o={},l={broadcast:n,presence:i,postgres_changes:null!=(r=null==(s=this.bindings.postgres_changes)?void 0:s.map(e=>e.filter))?r:[],private:a};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0===t){null==e||e(Z.SUBSCRIBED);return}{let r=this.bindings.postgres_changes,n=null!=(s=null==r?void 0:r.length)?s:0,i=[];for(let s=0;s<n;s++){let n=r[s],{filter:{event:a,schema:o,table:l,filter:h}}=n,c=t&&t[s];if(c&&c.event===a&&c.schema===o&&c.table===l&&c.filter===h)i.push(Object.assign(Object.assign({},n),{id:c.id}));else{this.unsubscribe(),null==e||e(Z.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=i,e&&e(Z.SUBSCRIBED);return}}).receive("error",t=>{null==e||e(Z.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Z.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,n,i;let a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null==(i=null==(n=null==(r=this.params)?void 0:r.config)?void 0:n.broadcast)?void 0:i.ack)||s("ok"),a.receive("ok",()=>s("ok")),a.receive("error",()=>s("error")),a.receive("timeout",()=>s("timed out"))});{let{event:n,payload:i}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!=(s=t.timeout)?s:this.timeout);return await (null==(r=e.body)?void 0:r.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=H.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(z.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{let r=new P(this,z.leave,{},e);r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){let r=new AbortController,n=setTimeout(()=>r.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(n),i}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new P(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,n;let i=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:h}=z;if(s&&[a,o,l,h].indexOf(i)>=0&&s!==this._joinRef())return;let c=this._onMessage(i,t,s);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null==(r=this.bindings.postgres_changes)||r.filter(e=>{var t,s,r;return(null==(t=e.filter)?void 0:t.event)==="*"||(null==(r=null==(s=e.filter)?void 0:s.event)?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(c,s)):null==(n=this.bindings[i])||n.filter(e=>{var s,r,n,a,o,l;if(!["broadcast","presence","postgres_changes"].includes(i))return e.type.toLocaleLowerCase()===i;if("id"in e){let i=e.id,a=null==(s=e.filter)?void 0:s.event;return i&&(null==(r=t.ids)?void 0:r.includes(i))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null==(n=t.data)?void 0:n.type.toLocaleLowerCase()))}{let s=null==(o=null==(a=null==e?void 0:e.filter)?void 0:a.event)?void 0:o.toLocaleLowerCase();return"*"===s||s===(null==(l=null==t?void 0:t.event)?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof c&&"ids"in c){let e=c.data,{schema:t,table:s,commit_timestamp:r,type:n,errors:i}=e;c=Object.assign(Object.assign({},{schema:t,table:s,commit_timestamp:r,eventType:n,new:{},old:{},errors:i}),this._getPayloadRecords(e))}e.callback(c,s)})}_isClosed(){return this.state===H.closed}_isJoined(){return this.state===H.joined}_isJoining(){return this.state===H.joining}_isLeaving(){return this.state===H.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){let r=e.toLocaleLowerCase(),n={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}_off(e,t){let s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null==(r=e.type)?void 0:r.toLocaleLowerCase())===s&&$.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(z.close,{},e)}_onError(e){this._on(z.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=H.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=w(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=w(e.columns,e.old_record)),t}}let R=()=>{},j="undefined"!=typeof WebSocket,C=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class I{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=g,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=R,this.conn=null,this.sendBuffer=[],this.serializer=new m,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(s.bind(s,2410)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${K.websocket}`,this.httpEndpoint=T(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let n=null==(r=null==t?void 0:t.params)?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new y(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(j){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new L(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),s.e(294).then(s.t.bind(s,294,23)).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case W.connecting:return V.Connecting;case W.open:return V.Open;case W.closing:return V.Closing;default:return V.Closed}}isConnected(){return this.connectionState()===V.Open}channel(e,t={config:{}}){let s=new $(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){let{topic:t,event:s,payload:r,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null==(t=this.conn)||t.send(e)})};this.log("push",`${t} ${s} (${n})`,r),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(e){}if(e&&e.exp&&!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`);this.accessTokenValue=t,this.channels.forEach(e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(z.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),null==(e=this.conn)||e.close(1e3,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:s,payload:r,ref:n}=e;n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${n&&"("+n+")"||""}`,r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,n)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(z.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([C],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class L{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=W.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class U extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class N extends U{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class D extends U{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let M=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(s.bind(s,2410)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},F=()=>(function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})})(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(s.bind(s,2410))).Response:Response}),q=e=>{if(Array.isArray(e))return e.map(e=>q(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,s])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=q(s)}),t};var J,W,H,z,K,V,G,X,Y,Q,Z,ee=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})};let et=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),es=(e,t,s)=>ee(void 0,void 0,void 0,function*(){e instanceof(yield F())&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{t(new N(et(s),e.status||500))}).catch(e=>{t(new D(et(e),e))}):t(new D(et(e),e))}),er=(e,t,s,r)=>{let n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),s))};function en(e,t,s,r,n,i){return ee(this,void 0,void 0,function*(){return new Promise((a,o)=>{e(s,er(t,r,n,i)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>a(e)).catch(e=>es(e,o,r))})})}function ei(e,t,s,r){return ee(this,void 0,void 0,function*(){return en(e,"GET",t,s,r)})}function ea(e,t,s,r,n){return ee(this,void 0,void 0,function*(){return en(e,"POST",t,r,n,s)})}function eo(e,t,s,r,n){return ee(this,void 0,void 0,function*(){return en(e,"DELETE",t,r,n,s)})}var el=s(9641).Buffer,eh=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})};let ec={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eu={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ed{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=M(r)}uploadOrUpdate(e,t,s,r){return eh(this,void 0,void 0,function*(){try{let n,i=Object.assign(Object.assign({},eu),r),a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)}),o=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?((n=new FormData).append("cacheControl",i.cacheControl),o&&n.append("metadata",this.encodeMetadata(o)),n.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?((n=s).append("cacheControl",i.cacheControl),o&&n.append("metadata",this.encodeMetadata(o))):(n=s,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(a=Object.assign(Object.assign({},a),r.headers));let l=this._removeEmptyFolders(t),h=this._getFinalPath(l),c=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:n,headers:a},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{})),u=yield c.json();if(c.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(e){if(B(e))return{data:null,error:e};throw e}})}upload(e,t,s){return eh(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return eh(this,void 0,void 0,function*(){let n=this._removeEmptyFolders(e),i=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",t);try{let e,t=Object.assign({upsert:eu.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s).append("cacheControl",t.cacheControl):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);let o=yield this.fetch(a.toString(),{method:"PUT",body:e,headers:i}),l=yield o.json();if(o.ok)return{data:{path:n,fullPath:l.Key},error:null};return{data:null,error:l}}catch(e){if(B(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e,t){return eh(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");let n=yield ea(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+n.url),a=i.searchParams.get("token");if(!a)throw new U("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}update(e,t,s){return eh(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return eh(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}copy(e,t,s){return eh(this,void 0,void 0,function*(){try{return{data:{path:(yield ea(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,s){return eh(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield ea(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,s){return eh(this,void 0,void 0,function*(){try{let r=yield ea(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}download(e,t){return eh(this,void 0,void 0,function*(){let s=void 0!==(null==t?void 0:t.transform),r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=r?`?${r}`:"";try{let t=this._getFinalPath(e),r=yield ei(this.fetch,`${this.url}/${s?"render/image/authenticated":"object"}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}info(e){return eh(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let e=yield ei(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:q(e),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}exists(e){return eh(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield function(e,t,s,r){return ee(this,void 0,void 0,function*(){return en(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(B(e)&&e instanceof D){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}})}getPublicUrl(e,t){let s=this._getFinalPath(e),r=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&r.push(n);let i=void 0!==(null==t?void 0:t.transform),a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&r.push(a);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i?"render/image":"object"}/public/${s}${o}`)}}}remove(e){return eh(this,void 0,void 0,function*(){try{return{data:yield eo(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}list(e,t,s){return eh(this,void 0,void 0,function*(){try{let r=Object.assign(Object.assign(Object.assign({},ec),t),{prefix:e||""});return{data:yield ea(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return void 0!==el?el.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let ef={"X-Client-Info":"storage-js/2.7.1"};var ep=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})};class eg{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},ef),t),this.fetch=M(s)}listBuckets(){return ep(this,void 0,void 0,function*(){try{return{data:yield ei(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return ep(this,void 0,void 0,function*(){try{return{data:yield ei(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}createBucket(e,t={public:!1}){return ep(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return ep(this,void 0,void 0,function*(){try{return{data:yield function(e,t,s,r,n){return ee(this,void 0,void 0,function*(){return en(e,"PUT",t,r,void 0,s)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}emptyBucket(e){return ep(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}deleteBucket(e){return ep(this,void 0,void 0,function*(){try{return{data:yield eo(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}}class em extends eg{constructor(e,t={},s){super(e,t,s)}from(e){return new ed(this.url,this.headers,e,this.fetch)}}let ey="";ey="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let ew={headers:{"X-Client-Info":`supabase-js-${ey}/2.49.4`}},e_={schema:"public"},eb={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ev={};var ek=s(2410);let eS=e=>{let t;return t=e||("undefined"==typeof fetch?ek.default:fetch),(...e)=>t(...e)},ex=()=>"undefined"==typeof Headers?ek.Headers:Headers,eE=(e,t,s)=>{let r=eS(s),n=ex();return(s,i)=>(function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})})(void 0,void 0,void 0,function*(){var a;let o=null!=(a=yield t())?a:e,l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},i),{headers:l}))})},eA="2.69.1",eT={"X-Client-Info":`gotrue-js/${eA}`},eP="X-Supabase-Api-Version",eO={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},e$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class eR extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function ej(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class eC extends eR{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class eI extends eR{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class eL extends eR{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class eU extends eL{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class eB extends eL{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class eN extends eL{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class eD extends eL{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class eM extends eL{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class eF extends eL{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function eq(e){return ej(e)&&"AuthRetryableFetchError"===e.name}class eJ extends eL{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class eW extends eL{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let eH="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ez=" 	\n\r=".split(""),eK=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<ez.length;t+=1)e[ez[t].charCodeAt(0)]=-2;for(let t=0;t<eH.length;t+=1)e[eH[t].charCodeAt(0)]=t;return e})();function eV(e,t,s){let r=eK[e];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else if(-2===r)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}function eG(e){let t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return s(e);for(let s=1;s<6;s+=1)if((e>>7-s&1)==0){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let t=0;t<e.length;t+=1)eV(e.charCodeAt(t),n,i);return t.join("")}let eX=()=>"undefined"!=typeof window&&"undefined"!=typeof document,eY={tested:!1,writable:!1},eQ=()=>{if(!eX())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(eY.tested)return eY.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),eY.tested=!0,eY.writable=!0}catch(e){eY.tested=!0,eY.writable=!1}return eY.writable},eZ=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(s.bind(s,2410)).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},e0=e=>"object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json,e1=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},e2=async(e,t)=>{let s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(e){return s}},e8=async(e,t)=>{await e.removeItem(t)};class e6{constructor(){this.promise=new e6.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function e5(e){let t=e.split(".");if(3!==t.length)throw new eW("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!e$.test(t[e]))throw new eW("JWT not in base64url format");return{header:JSON.parse(eG(t[0])),payload:JSON.parse(eG(t[1])),signature:function(e){let t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)eV(e.charCodeAt(t),s,r);return new Uint8Array(t)}(t[2]),raw:{header:t[0],payload:t[1]}}}async function e3(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function e4(e){return("0"+e.toString(16)).substr(-2)}async function e9(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>String.fromCharCode(e)).join("")}async function e7(e){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e):btoa(await e9(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function te(e,t,s=!1){let r=function(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,e4).join("")}(),n=r;s&&(n+="/PASSWORD_RECOVERY"),await e1(e,`${t}-code-verifier`,n);let i=await e7(r),a=r===i?"plain":"s256";return[i,a]}e6.promiseConstructor=Promise;let tt=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;var ts=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)0>t.indexOf(r[n])&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]]);return s};let tr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tn=[502,503,504];async function ti(e){var t;let s,r;if(!e0(e))throw new eF(tr(e),0);if(tn.includes(e.status))throw new eF(tr(e),e.status);try{s=await e.json()}catch(e){throw new eI(tr(e),e)}let n=function(e){let t=e.headers.get(eP);if(!t||!t.match(tt))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(n&&n.getTime()>=eO["2024-01-01"].timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?r=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(r=s.error_code),r){if("weak_password"===r)throw new eJ(tr(s),e.status,(null==(t=s.weak_password)?void 0:t.reasons)||[]);else if("session_not_found"===r)throw new eU}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new eJ(tr(s),e.status,s.weak_password.reasons);throw new eC(tr(s),e.status||500,r)}let ta=(e,t,s,r)=>{let n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))};async function to(e,t,s,r){var n;let i=Object.assign({},null==r?void 0:r.headers);i[eP]||(i[eP]=eO["2024-01-01"].name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);let a=null!=(n=null==r?void 0:r.query)?n:{};(null==r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);let o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await tl(e,t,s+o,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function tl(e,t,s,r,n,i){let a,o=ta(t,r,n,i);try{a=await e(s,Object.assign({},o))}catch(e){throw console.error(e),new eF(tr(e),0)}if(a.ok||await ti(a),null==r?void 0:r.noResolveJson)return a;try{return await a.json()}catch(e){await ti(e)}}function th(e){var t,s,r;let n=null;(r=e).access_token&&r.refresh_token&&r.expires_in&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:n,user:null!=(t=e.user)?t:e},error:null}}function tc(e){let t=th(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function tu(e){var t;return{data:{user:null!=(t=e.user)?t:e},error:null}}function td(e){return{data:e,error:null}}function tf(e){let{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i}=e;return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i},user:Object.assign({},ts(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function tp(e){return e}var tg=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)0>t.indexOf(r[n])&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]]);return s};class tm{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=eZ(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await to(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(ej(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await to(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:tu})}catch(e){if(ej(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,s=tg(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await to(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:tf,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(ej(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await to(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:tu})}catch(e){if(ej(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,s,r,n,i,a,o;try{let l={nextPage:null,lastPage:0,total:0},h=await to(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(s=null==(t=null==e?void 0:e.page)?void 0:t.toString())?s:"",per_page:null!=(n=null==(r=null==e?void 0:e.perPage)?void 0:r.toString())?n:""},xform:tp});if(h.error)throw h.error;let c=await h.json(),u=null!=(i=h.headers.get("x-total-count"))?i:0,d=null!=(o=null==(a=h.headers.get("link"))?void 0:a.split(","))?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(ej(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){try{return await to(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:tu})}catch(e){if(ej(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){try{return await to(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:tu})}catch(e){if(ej(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){try{return await to(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:tu})}catch(e){if(ej(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){try{let{data:t,error:s}=await to(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(e){if(ej(e))return{data:null,error:e};throw e}}async _deleteFactor(e){try{return{data:await to(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(ej(e))return{data:null,error:e};throw e}}}let ty={getItem:e=>eQ()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{eQ()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{eQ()&&globalThis.localStorage.removeItem(e)}};function tw(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}let t_={debug:!!(globalThis&&eQ()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class tb extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class tv extends tb{}async function tk(e,t,s){t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),t_.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(r){t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}if(0===t)throw t_.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new tv(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(t_.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}))}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}let tS={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:eT,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function tx(e,t,s){return await s()}class tE{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=tE.nextInstanceID,tE.nextInstanceID+=1,this.instanceID>0&&eX()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let r=Object.assign(Object.assign({},tS),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new tm({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=eZ(r.fetch),this.lock=r.lock||tx,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:eX()&&(null==(t=null==globalThis?void 0:globalThis.navigator)?void 0:t.locks)?this.lock=tk:this.lock=tx,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:eQ()?this.storage=ty:(this.memoryStorage={},this.storage=tw(this.memoryStorage)):(this.memoryStorage={},this.storage=tw(this.memoryStorage)),eX()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null==(s=this.broadcastChannel)||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${eA}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t=function(e){let t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(e){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href),s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),eX()&&this.detectSessionInUrl&&"none"!==s){let{data:r,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),ej(n)&&"AuthImplicitGrantRedirectError"===n.name){let t=null==(e=n.details)?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}let{session:i,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(ej(e))return{error:e};return{error:new eI("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{let{data:n,error:i}=await to(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(s=null==(t=null==e?void 0:e.options)?void 0:t.data)?s:{},gotrue_meta_security:{captcha_token:null==(r=null==e?void 0:e.options)?void 0:r.captchaToken}},xform:th});if(i||!n)return{data:{user:null,session:null},error:i};let a=n.session,o=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:o,session:a},error:null}}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,s,r;try{let n;if("email"in e){let{email:s,password:r,options:i}=e,a=null,o=null;"pkce"===this.flowType&&([a,o]=await te(this.storage,this.storageKey)),n=await to(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!=(t=null==i?void 0:i.data)?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:a,code_challenge_method:o},xform:th})}else if("phone"in e){let{phone:t,password:i,options:a}=e;n=await to(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!=(s=null==a?void 0:a.data)?s:{},channel:null!=(r=null==a?void 0:a.channel)?r:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:th})}else throw new eN("You must provide either an email or phone number and a password");let{data:i,error:a}=n;if(a||!i)return{data:{user:null,session:null},error:a};let o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:s,password:r,options:n}=e;t=await to(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:tc})}else if("phone"in e){let{phone:s,password:r,options:n}=e;t=await to(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:tc})}else throw new eN("You must provide either an email or phone number and a password");let{data:s,error:r}=t;if(r)return{data:{user:null,session:null},error:r};if(!s||!s.session||!s.user)return{data:{user:null,session:null},error:new eB};return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,s,r,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null==(t=e.options)?void 0:t.redirectTo,scopes:null==(s=e.options)?void 0:s.scopes,queryParams:null==(r=e.options)?void 0:r.queryParams,skipBrowserRedirect:null==(n=e.options)?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let t=await e2(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{let{data:t,error:n}=await to(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:th});if(await e8(this.storage,`${this.storageKey}-code-verifier`),n)throw n;if(!t||!t.session||!t.user)return{data:{user:null,session:null,redirectType:null},error:new eB};return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:n}}catch(e){if(ej(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{let{options:t,provider:s,token:r,access_token:n,nonce:i}=e,{data:a,error:o}=await to(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:th});if(o)return{data:{user:null,session:null},error:o};if(!a||!a.session||!a.user)return{data:{user:null,session:null},error:new eB};return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:o}}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,s,r,n,i;try{if("email"in e){let{email:r,options:n}=e,i=null,a=null;"pkce"===this.flowType&&([i,a]=await te(this.storage,this.storageKey));let{error:o}=await to(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!=(t=null==n?void 0:n.data)?t:{},create_user:null==(s=null==n?void 0:n.shouldCreateUser)||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:a},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){let{phone:t,options:s}=e,{data:a,error:o}=await to(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!=(r=null==s?void 0:s.data)?r:{},create_user:null==(n=null==s?void 0:s.shouldCreateUser)||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!=(i=null==s?void 0:s.channel)?i:"sms"}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new eN("You must provide either an email or phone number.")}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,s;try{let r,n;"options"in e&&(r=null==(t=e.options)?void 0:t.redirectTo,n=null==(s=e.options)?void 0:s.captchaToken);let{data:i,error:a}=await to(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:th});if(a)throw a;if(!i)throw Error("An error occurred on token verification.");let o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,s,r;try{let n=null,i=null;return"pkce"===this.flowType&&([n,i]=await te(this.storage,this.storageKey)),await to(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!=(s=null==(t=e.options)?void 0:t.redirectTo)?s:void 0}),(null==(r=null==e?void 0:e.options)?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:td})}catch(e){if(ej(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new eU;let{error:r}=await to(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:s,type:r,options:n}=e,{error:i}=await to(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){let{phone:s,type:r,options:n}=e,{data:i,error:a}=await to(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:a}}throw new eN("You must provide either an email or phone number and a type")}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let e=null,t=await e2(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let s=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}let{session:r,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return{data:{session:null},error:n};return{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{if(e)return await to(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:tu});return await this._useSession(async e=>{var t,s,r;let{data:n,error:i}=e;if(i)throw i;return(null==(t=n.session)?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await to(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(r=null==(s=n.session)?void 0:s.access_token)?r:void 0,xform:tu}):{data:{user:null},error:new eU}})}catch(e){if(ej(e))return ej(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await e8(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{let{data:r,error:n}=s;if(n)throw n;if(!r.session)throw new eU;let i=r.session,a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await te(this.storage,this.storageKey));let{data:l,error:h}=await to(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:i.access_token,xform:tu});if(h)throw h;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(e){if(ej(e))return{data:{user:null},error:e};throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new eU;let t=Date.now()/1e3,s=t,r=!0,n=null,{payload:i}=e5(e.access_token);if(i.exp&&(r=(s=i.exp)<=t),r){let{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};n=t}else{let{data:r,error:i}=await this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(ej(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){let{data:r,error:n}=t;if(n)throw n;e=null!=(s=r.session)?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new eU;let{session:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(ej(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e,t){try{if(!eX())throw new eD("No browser detected.");if(e.error||e.error_description||e.error_code)throw new eD(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new eM("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new eD("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new eM("No code detected.");let{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;let r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:r,access_token:n,refresh_token:i,expires_in:a,expires_at:o,token_type:l}=e;if(!n||!a||!i||!l)throw new eD("No session defined in URL");let h=Math.round(Date.now()/1e3),c=parseInt(a),u=h+c;o&&(u=parseInt(o));let d=u-h;1e3*d<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${c}s`);let f=u-c;h-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,u,h):h-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,u,h);let{data:p,error:g}=await this._getUser(n);if(g)throw g;let m={provider_token:s,provider_refresh_token:r,access_token:n,expires_in:c,expires_at:u,refresh_token:i,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(e){if(ej(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await e2(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;let{data:r,error:n}=t;if(n)return{error:n};let i=null==(s=r.session)?void 0:s.access_token;if(i){let{error:t}=await this.admin.signOut(i,e);if(t&&!(ej(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return{error:t}}return"others"!==e&&(await this._removeSession(),await e8(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{let{data:{session:r},error:n}=t;if(n)throw n;await (null==(s=this.stateChangeEmitters.get(e))?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(t){await (null==(r=this.stateChangeEmitters.get(e))?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await te(this.storage,this.storageKey,!0));try{return await to(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(ej(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{let{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!=(e=t.user.identities)?e:[]},error:null}}catch(e){if(ej(e))return{data:null,error:e};throw e}}async linkIdentity(e){var t;try{let{data:s,error:r}=await this._useSession(async t=>{var s,r,n,i,a;let{data:o,error:l}=t;if(l)throw l;let h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null==(s=e.options)?void 0:s.redirectTo,scopes:null==(r=e.options)?void 0:r.scopes,queryParams:null==(n=e.options)?void 0:n.queryParams,skipBrowserRedirect:!0});return await to(this.fetch,"GET",h,{headers:this.headers,jwt:null!=(a=null==(i=o.session)?void 0:i.access_token)?a:void 0})});if(r)throw r;return!eX()||(null==(t=e.options)?void 0:t.skipBrowserRedirect)||window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(t){if(ej(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;let{data:n,error:i}=t;if(i)throw i;return await to(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!=(r=null==(s=n.session)?void 0:s.access_token)?r:void 0})})}catch(e){if(ej(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var s,r;let n=Date.now();return await (s=async s=>(s>0&&await e3(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await to(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:th})),r=(e,t)=>{let s=200*Math.pow(2,e);return t&&eq(t)&&Date.now()+s-n<3e4},new Promise((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{let t=await s(n);if(!r(n,null,t))return void e(t)}catch(e){if(!r(n,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),ej(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),eX()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;let t="#_recoverAndRefresh()";this._debug(t,"begin");try{let s=await e2(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),null!==s&&await this._removeSession();return}let r=(null!=(e=s.expires_at)?e:1/0)*1e3-Date.now()<9e4;if(this._debug(t,`session has${r?"":" not"} expired with margin of 90000s`),r){if(this.autoRefreshToken&&s.refresh_token){let{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),eq(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){this._debug(t,"error",e),console.error(e);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new eU;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new e6;let{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new eU;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(e){if(this._debug(r,"error",e),ej(e)){let s={session:null,error:e};return eq(e)||await this._removeSession(),null==(t=this.refreshingDeferred)||t.resolve(s),s}throw null==(s=this.refreshingDeferred)||s.reject(e),e}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){let r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});let r=[],n=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(e){r.push(e)}});if(await Promise.all(n),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await e1(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await e8(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&eX()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let r=Math.floor((1e3*s.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof tb)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!eX()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if("visible"!==document.visibilityState)return void this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){let r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){let[e,t]=await te(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){let e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;let{data:r,error:n}=t;return n?{data:null,error:n}:await to(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null==(s=null==r?void 0:r.session)?void 0:s.access_token})})}catch(e){if(ej(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;let{data:n,error:i}=t;if(i)return{data:null,error:i};let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await to(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null==(s=null==n?void 0:n.session)?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null==(r=null==o?void 0:o.totp)?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(e){if(ej(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:r,error:n}=t;if(n)return{data:null,error:n};let{data:i,error:a}=await to(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null==(s=null==r?void 0:r.session)?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(e){if(ej(e))return{data:null,error:e};throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:r,error:n}=t;return n?{data:null,error:n}:await to(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null==(s=null==r?void 0:r.session)?void 0:s.access_token})})}catch(e){if(ej(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(e){let{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){let{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};let s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;let{data:{session:r},error:n}=e;if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:i}=e5(r.access_token),a=null;i.aal&&(a=i.aal);let o=a;return(null!=(s=null==(t=r.user.factors)?void 0:t.filter(e=>"verified"===e.status))?s:[]).length>0&&(o="aal2"),{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:i.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s||(s=this.jwks.keys.find(t=>t.kid===e))&&this.jwks_cached_at+6e5>Date.now())return s;let{data:r,error:n}=await to(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!r.keys||0===r.keys.length)throw new eW("JWKS is empty");if(this.jwks=r,this.jwks_cached_at=Date.now(),!(s=r.keys.find(t=>t.kid===e)))throw new eW("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){let{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}let{header:n,payload:i,signature:a,raw:{header:o,payload:l}}=e5(r);var s=i.exp;if(!s)throw Error("Missing exp claim");if(s<=Math.floor(Date.now()/1e3))throw Error("JWT has expired");if(!n.kid||"HS256"===n.alg||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){let{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:i,header:n,signature:a},error:null}}let h=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(n.alg),c=await this.fetchJwk(n.kid,t),u=await crypto.subtle.importKey("jwk",c,h,!0,["verify"]);if(!await crypto.subtle.verify(h,u,a,function(e){let t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){let t=(r-55296)*1024&65535;r=(e.charCodeAt(s+1)-56320&65535|t)+65536,s+=1}!function(e,t){if(e<=127)return t(e);if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${o}.${l}`)))throw new eW("Invalid JWT signature");return{data:{claims:i,header:n,signature:a},error:null}}catch(e){if(ej(e))return{data:null,error:e};throw e}}}tE.nextInstanceID=0;let tA=tE;class tT extends tA{constructor(e){super(e)}}class tP{constructor(e,t,s){var r,n,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw Error("supabaseUrl is required.");if(!t)throw Error("supabaseKey is required.");let a=e.replace(/\/$/,"");this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let o=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(e,t){let{db:s,auth:r,realtime:n,global:i}=e,{db:a,auth:o,realtime:l,global:h}=t,c={db:Object.assign(Object.assign({},a),s),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},h),i),accessToken:()=>{var e,t,s,r;return e=this,t=void 0,r=function*(){return""},new(s=void 0,s=Promise)(function(n,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})}};return e.accessToken?c.accessToken=e.accessToken:delete c.accessToken,c}(null!=s?s:{},{db:e_,realtime:ev,auth:Object.assign(Object.assign({},eb),{storageKey:o}),global:ew});this.storageKey=null!=(r=l.auth.storageKey)?r:"",this.headers=null!=(n=l.global.headers)?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(i=l.auth)?i:{},this.headers,l.global.fetch),this.fetch=eE(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new h(`${a}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new l(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new em(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,s,r,n,i;return s=this,r=void 0,n=void 0,i=function*(){if(this.accessToken)return yield this.accessToken();let{data:s}=yield this.auth.getSession();return null!=(t=null==(e=s.session)?void 0:e.access_token)?t:null},new(n||(n=Promise))(function(e,t){function a(e){try{l(i.next(e))}catch(e){t(e)}}function o(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):((s=t.value)instanceof n?s:new n(function(e){e(s)})).then(a,o)}l((i=i.apply(s,r||[])).next())})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:n,flowType:i,lock:a,debug:o},l,h){let c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new tT({url:this.authUrl,headers:Object.assign(Object.assign({},c),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:i,lock:a,debug:o,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new I(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==s?this.changedAccessToken=s:"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}}let tO=(e,t,s)=>new tP(e,t,s)},1971:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=s},2410:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Headers:()=>a,Request:()=>o,Response:()=>l,default:()=>i,fetch:()=>n});var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==s.g)return s.g;throw Error("unable to locate global object")}();let n=r.fetch,i=r.fetch.bind(r),a=r.Headers,o=r.Request,l=r.Response},3280:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(s(7156));class i extends n.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let s=Array.from(new Set(t)).map(e=>"string"==typeof e&&RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");let i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){let r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}t.default=i},3290:(e,t,s)=>{"use strict";let r,n,i,a,o,l,h,c,u,d;s.d(t,{z4:()=>r_});let f="RFC3986",p={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},g=(Object.prototype.hasOwnProperty,Array.isArray),m=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function y(e,t){if(g(e)){let s=[];for(let r=0;r<e.length;r+=1)s.push(t(e[r]));return s}return t(e)}let w=Object.prototype.hasOwnProperty,_={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},b=Array.isArray,v=Array.prototype.push,k=function(e,t){v.apply(e,b(t)?t:[t])},S=Date.prototype.toISOString,x={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,r,n)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===n&&(40===r||41===r)){s[s.length]=t.charAt(e);continue}if(r<128){s[s.length]=m[r];continue}if(r<2048){s[s.length]=m[192|r>>6]+m[128|63&r];continue}if(r<55296||r>=57344){s[s.length]=m[224|r>>12]+m[128|r>>6&63]+m[128|63&r];continue}e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),s[s.length]=m[240|r>>18]+m[128|r>>12&63]+m[128|r>>6&63]+m[128|63&r]}a+=s.join("")}return a},encodeValuesOnly:!1,format:f,formatter:p[f],indices:!1,serializeDate:e=>S.call(e),skipNulls:!1,strictNullHandling:!1},E={},A="4.95.1",T=!1;class P{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}let O=()=>{n||function(e,t={auto:!1}){if(T)throw Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(n)throw Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${n}'\``);T=t.auto,n=e.kind,i=e.fetch,e.Request,e.Response,e.Headers,a=e.FormData,e.Blob,o=e.File,l=e.ReadableStream,h=e.getMultipartRequestOptions,c=e.getDefaultAgent,u=e.fileFromPath,d=e.isFsReadStream}(function({manuallyImported:e}={}){let t,s,r,n,i=e?"You may need to use polyfills":`Add one of these imports before your first \`import … from 'openai'\`:
- \`import 'openai/shims/node'\` (if you're running on Node)
- \`import 'openai/shims/web'\` (otherwise)
`;try{t=fetch,s=Request,r=Response,n=Headers}catch(e){throw Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${i}`)}return{kind:"web",fetch:t,Request:s,Response:r,Headers:n,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${i}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${i}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${i}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${i}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new P(e)}),getDefaultAgent:e=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};O();class $ extends Error{}class R extends ${constructor(e,t,s,r){super(`${R.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new C({message:s,cause:tB(t)});let n=t?.error;return 400===e?new L(e,n,s,r):401===e?new U(e,n,s,r):403===e?new B(e,n,s,r):404===e?new N(e,n,s,r):409===e?new D(e,n,s,r):422===e?new M(e,n,s,r):429===e?new F(e,n,s,r):e>=500?new q(e,n,s,r):new R(e,n,s,r)}}class j extends R{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class C extends R{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class I extends C{constructor({message:e}={}){super({message:e??"Request timed out."})}}class L extends R{}class U extends R{}class B extends R{}class N extends R{}class D extends R{}class M extends R{}class F extends R{}class q extends R{}class J extends ${constructor(){super("Could not parse response content as the length limit was reached")}}class W extends ${constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var H,z,K,V,G,X,Y,Q,Z,ee,et,es,er,en,ei,ea,eo,el,eh,ec,eu,ed,ef,ep,eg,em,ey,ew,e_,eb,ev,ek,eS,ex,eE,eA,eT,eP,eO,e$,eR,ej,eC,eI,eL,eU,eB,eN,eD,eM,eF,eq,eJ,eW,eH,ez,eK,eV,eG,eX,eY,eQ,eZ,e0,e1,e2=s(9641).Buffer,e8=function(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},e6=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};class e5{constructor(){H.set(this,void 0),this.buffer=new Uint8Array,e8(this,H,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+s.length);r.set(this.buffer),r.set(s,this.buffer.length),this.buffer=r;let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(this.buffer,e6(this,H,"f")));){if(t.carriage&&null==e6(this,H,"f")){e8(this,H,t.index,"f");continue}if(null!=e6(this,H,"f")&&(t.index!==e6(this,H,"f")+1||t.carriage)){n.push(this.decodeText(this.buffer.slice(0,e6(this,H,"f")-1))),this.buffer=this.buffer.slice(e6(this,H,"f")),e8(this,H,null,"f");continue}let e=null!==e6(this,H,"f")?t.preceding-1:t.preceding,s=this.decodeText(this.buffer.slice(0,e));n.push(s),this.buffer=this.buffer.slice(t.index),e8(this,H,null,"f")}return n}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(void 0!==e2){if(e instanceof e2)return e.toString();if(e instanceof Uint8Array)return e2.from(e).toString();throw new $(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new $(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new $("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function e3(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}H=new WeakMap,e5.NEWLINE_CHARS=new Set(["\n","\r"]),e5.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class e4{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*r(){if(s)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(let s of e9(e,t))if(!r){if(s.data.startsWith("[DONE]")){r=!0;continue}if(null===s.event||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let t;try{t=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(t&&t.error)throw new R(void 0,t.error,void 0,tE(e.headers));yield t}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new R(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}return new e4(r,t)}static fromReadableStream(e,t){let s=!1;async function*r(){let t=new e5;for await(let s of e3(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new e4(async function*(){if(s)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new e4(()=>r(e),this.controller),new e4(()=>r(t),this.controller)]}toReadableStream(){let e,t=this,s=new TextEncoder;return new l({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:n}=await e.next();if(n)return t.close();let i=s.encode(JSON.stringify(r)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*e9(e,t){if(!e.body)throw t.abort(),new $("Attempted to iterate over a response with no body");let s=new te,r=new e5;for await(let t of e7(e3(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*e7(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?new TextEncoder().encode(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class te{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}var tt=s(9641).Buffer;let ts=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,tr=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tn(e),tn=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,ti=e=>tr(e)||ts(e)||d(e);async function ta(e,t,s){var r;if(tr(e=await e))return e;if(ts(e)){let r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");let n=tn(r)?[await r.arrayBuffer()]:[r];return new o(n,t,s)}let n=await to(e);if(t||(t=(tl((r=e).name)||tl(r.filename)||tl(r.path)?.split(/[\\/]/).pop())??"unknown_file"),!s?.type){let e=n[0]?.type;"string"==typeof e&&(s={...s,type:e})}return new o(n,t,s)}async function to(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tn(e))t.push(await e.arrayBuffer());else if(th(e))for await(let s of e)t.push(s);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let tl=e=>"string"==typeof e?e:void 0!==tt&&e instanceof tt?String(e):void 0,th=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tc=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],tu=async e=>{let t=await td(e.body);return h(t,e)},td=async e=>{let t=new a;return await Promise.all(Object.entries(e||{}).map(([e,s])=>tp(t,e,s))),t},tf=e=>{if(ti(e))return!0;if(Array.isArray(e))return e.some(tf);if(e&&"object"==typeof e){for(let t in e)if(tf(e[t]))return!0}return!1},tp=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(ti(s)){let r=await ta(s);e.append(t,r)}else if(Array.isArray(s))await Promise.all(s.map(s=>tp(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>tp(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}};var tg=s(9641).Buffer,tm=s(9509),ty=function(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},tw=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};async function t_(e){let{response:t}=e;if(e.options.stream)return(tJ("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):e4.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let s=t.headers.get("content-type"),r=s?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let e=await t.json();return tJ("response",t.status,t.url,t.headers,e),tb(e,t)}let n=await t.text();return tJ("response",t.status,t.url,t.headers,n),n}function tb(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}O();class tv extends Promise{constructor(e,t=t_){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new tv(this.responsePromise,async t=>tb(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class tk{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:r,fetch:n}){this.baseURL=e,this.maxRetries=tU("maxRetries",t),this.timeout=tU("timeout",s),this.httpAgent=r,this.fetch=n??i}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...tR(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${tW()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(async s=>{let r=s&&tn(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:r}}))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if("string"==typeof e){if(void 0!==tg)return tg.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,headers:a={}}=s,o=ArrayBuffer.isView(s.body)||s.__binaryRequest&&"string"==typeof s.body?s.body:tc(s.body)?s.body.body:s.body?JSON.stringify(s.body,null,2):null,l=this.calculateContentLength(o),h=this.buildURL(n,i);"timeout"in s&&tU("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let u=s.httpAgent??this.httpAgent??c(h),d=s.timeout+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:s,headers:a,contentLength:l,retryCount:t});return{req:{method:r,...o&&{body:o},headers:f,...u&&{agent:u},signal:s.signal??null},url:h,timeout:s.timeout}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:r}){let i={};s&&(i["content-length"]=s);let a=this.defaultHeaders(e);return tF(i,a),tF(i,t),tc(e.body)&&"node"!==n&&delete i["content-type"],void 0===tK(a,"x-stainless-retry-count")&&void 0===tK(t,"x-stainless-retry-count")&&(i["x-stainless-retry-count"]=String(r)),void 0===tK(a,"x-stainless-timeout")&&void 0===tK(t,"x-stainless-timeout")&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,s,r){return R.generate(e,t,s,r)}request(e,t=null){return new tv(this.makeRequest(e,t))}async makeRequest(e,t){let s=await e,r=s.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(s);let{req:n,url:i,timeout:a}=this.buildRequest(s,{retryCount:r-t});if(await this.prepareRequest(n,{url:i,options:s}),tJ("request",i,s,n.headers),s.signal?.aborted)throw new j;let o=new AbortController,l=await this.fetchWithTimeout(i,n,a,o).catch(tB);if(l instanceof Error){if(s.signal?.aborted)throw new j;if(t)return this.retryRequest(s,t);if("AbortError"===l.name)throw new I;throw new C({cause:l})}let h=tE(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let e=`retrying, ${t} attempts remaining`;return tJ(`response (error; ${e})`,l.status,i,h),this.retryRequest(s,t,h)}let e=await l.text().catch(e=>tB(e).message),r=tj(e),n=r?void 0:e,a=t?"(error; no more retries left)":"(error; not retryable)";throw tJ(`response (error; ${a})`,l.status,i,h,n),this.makeStatusError(l.status,r,n,h)}return{response:l,options:s,controller:o}}requestAPIList(e,t){return new tx(this,this.makeRequest(t,null),e)}buildURL(e,t){let s=new URL(tI(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return tD(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new $(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,s,r){let{signal:n,...i}=t||{};n&&n.addEventListener("abort",()=>r.abort());let a=setTimeout(()=>r.abort(),s),o={signal:r.signal,...i};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally(()=>{clearTimeout(a)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s){let r,n=s?.["retry-after-ms"];if(n){let e=parseFloat(n);Number.isNaN(e)||(r=e)}let i=s?.["retry-after"];if(i&&!r){let e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await tL(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${A}`}}class tS{constructor(e,t,s,r){z.set(this,void 0),ty(this,z,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new $("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){for(let[s,r]of[...Object.entries(t.query||{}),...e.url.searchParams.entries()])e.url.searchParams.set(s,r);t.query=void 0,t.path=e.url.toString()}return await tw(this,z,"f").requestAPIList(this.constructor,t)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(z=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tx extends tv{constructor(e,t,s){super(t,async t=>new s(e,t.response,await t_(t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}let tE=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let s=t.toString();return e[s.toLowerCase()]||e[s]}}),tA={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},tT=e=>"object"==typeof e&&null!==e&&!tD(e)&&Object.keys(e).every(e=>tM(tA,e)),tP=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":A,"X-Stainless-OS":t$(Deno.build.os),"X-Stainless-Arch":tO(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":A,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":tm.version};if("[object process]"===Object.prototype.toString.call(void 0!==tm?tm:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":A,"X-Stainless-OS":t$(tm.platform),"X-Stainless-Arch":tO(tm.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":tm.version};let e=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":A,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":A,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},tO=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",t$=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",tR=()=>r??(r=tP()),tj=e=>{try{return JSON.parse(e)}catch(e){return}},tC=/^[a-z][a-z0-9+.-]*:/i,tI=e=>tC.test(e),tL=e=>new Promise(t=>setTimeout(t,e)),tU=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new $(`${e} must be an integer`);if(t<0)throw new $(`${e} must be a positive integer`);return t},tB=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return Error(JSON.stringify(e))}catch{}return Error(e)},tN=e=>void 0!==tm?tm.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function tD(e){if(!e)return!0;for(let t in e)return!1;return!0}function tM(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function tF(e,t){for(let s in t){if(!tM(t,s))continue;let r=s.toLowerCase();if(!r)continue;let n=t[s];null===n?delete e[r]:void 0!==n&&(e[r]=n)}}let tq=new Set(["authorization","api-key"]);function tJ(e,...t){void 0!==tm&&tm?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${e}`,...t.map(e=>{if(!e)return e;if(e.headers){let t={...e,headers:{...e.headers}};for(let s in e.headers)tq.has(s.toLowerCase())&&(t.headers[s]="REDACTED");return t}let t=null;for(let s in e)tq.has(s.toLowerCase())&&(t??(t={...e}),t[s]="REDACTED");return t??e}))}let tW=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),tH=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,tz=e=>"function"==typeof e?.get,tK=(e,t)=>{let s=t.toLowerCase();if(tz(e)){let r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,(e,t,s)=>t+s.toUpperCase());for(let n of[t,s,t.toUpperCase(),r]){let t=e.get(n);if(t)return t}}for(let[r,n]of Object.entries(e))if(r.toLowerCase()===s){if(Array.isArray(n)){if(n.length<=1)return n[0];return console.warn(`Received ${n.length} entries for the ${t} header, using the first entry.`),n[0]}return n}},tV=e=>{if(void 0!==tg){let t=tg.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}};function tG(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class tX{constructor(e){this._client=e}}class tY extends tX{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class tQ extends tX{list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,t8,{query:t,...s})}}class tZ extends tS{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class t0 extends tS{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class t1 extends tX{constructor(){super(...arguments),this.messages=new tQ(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/chat/completions",t2,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class t2 extends t0{}class t8 extends t0{}t1.ChatCompletionsPage=t2,t1.Messages=tQ;class t6 extends tX{constructor(){super(...arguments),this.completions=new t1(this._client)}}t6.Completions=t1,t6.ChatCompletionsPage=t2;class t5 extends tX{create(e,t){let s=!!e.encoding_format,r=s?e.encoding_format:"base64";s&&tJ("Request","User defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return s?n:(tJ("response","Decoding base64 embeddings to float32 array"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=tV(t)}),e)))}}class t3 extends tX{create(e,t){return this._client.post("/files",tu({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/files",t4,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let r=new Set(["processed","error","deleted"]),n=Date.now(),i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await tL(t),i=await this.retrieve(e),Date.now()-n>s)throw new I({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class t4 extends t0{}t3.FileObjectsPage=t4;class t9 extends tX{createVariation(e,t){return this._client.post("/images/variations",tu({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",tu({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class t7 extends tX{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class se extends tX{create(e,t){return this._client.post("/audio/transcriptions",tu({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class st extends tX{create(e,t){return this._client.post("/audio/translations",tu({body:e,...t,__metadata:{model:e.model}}))}}class ss extends tX{constructor(){super(...arguments),this.transcriptions=new se(this._client),this.translations=new st(this._client),this.speech=new t7(this._client)}}ss.Transcriptions=se,ss.Translations=st,ss.Speech=t7;class sr extends tX{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class sn extends tX{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",si,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class si extends tZ{}sn.ModelsPage=si;class sa extends tX{create(e,t,s){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,so,{body:t,method:"post",...s})}retrieve(e,t={},s){return tT(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}del(e,t){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions`,t)}}class so extends tZ{}sa.PermissionCreateResponsesPage=so;class sl extends tX{constructor(){super(...arguments),this.permissions=new sa(this._client)}}sl.Permissions=sa,sl.PermissionCreateResponsesPage=so;class sh extends tX{list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,sc,{query:t,...s})}}class sc extends t0{}sh.FineTuningJobCheckpointsPage=sc;class su extends tX{constructor(){super(...arguments),this.checkpoints=new sh(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",sd,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return tT(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,sf,{query:t,...s})}}class sd extends t0{}class sf extends t0{}su.FineTuningJobsPage=sd,su.FineTuningJobEventsPage=sf,su.Checkpoints=sh,su.FineTuningJobCheckpointsPage=sc;class sp extends tX{constructor(){super(...arguments),this.jobs=new su(this._client),this.checkpoints=new sl(this._client)}}sp.Jobs=su,sp.FineTuningJobsPage=sd,sp.FineTuningJobEventsPage=sf,sp.Checkpoints=sl;let sg=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)"fulfilled"===e.status&&r.push(e.value);return r};class sm extends tX{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,sy,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){let r={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let n=await this.retrieve(e,t,{...s,headers:r}).withResponse(),i=n.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await tL(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){let r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,sw,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class sy extends t0{}class sw extends tZ{}sm.VectorStoreFilesPage=sy,sm.FileContentResponsesPage=sw;class s_ extends tX{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){let r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s={},r){return tT(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,sy,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,s){let r={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let{data:n,response:i}=await this.retrieve(e,t,{...s,headers:r}).withResponse();switch(n.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await tL(a);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(r?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},r);o.push(e.id)}}let h=Array(n).fill(a).map(l);return await sg(h),await this.createAndPoll(e,{file_ids:o})}}class sb extends tX{constructor(){super(...arguments),this.files=new sm(this._client),this.fileBatches=new s_(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/vector_stores",sv,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,s){return this._client.getAPIList(`/vector_stores/${e}/search`,sk,{body:t,method:"post",...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class sv extends t0{}class sk extends tZ{}sb.VectorStoresPage=sv,sb.VectorStoreSearchResponsesPage=sk,sb.Files=sm,sb.VectorStoreFilesPage=sy,sb.FileContentResponsesPage=sw,sb.FileBatches=s_;class sS extends tX{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/assistants",sx,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class sx extends t0{}function sE(e){return"function"==typeof e.parse}sS.AssistantsPage=sx;let sA=e=>e?.role==="assistant",sT=e=>e?.role==="function",sP=e=>e?.role==="tool";var sO=function(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},s$=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};class sR{constructor(){K.add(this),this.controller=new AbortController,V.set(this,void 0),G.set(this,()=>{}),X.set(this,()=>{}),Y.set(this,void 0),Q.set(this,()=>{}),Z.set(this,()=>{}),ee.set(this,{}),et.set(this,!1),es.set(this,!1),er.set(this,!1),en.set(this,!1),sO(this,V,new Promise((e,t)=>{sO(this,G,e,"f"),sO(this,X,t,"f")}),"f"),sO(this,Y,new Promise((e,t)=>{sO(this,Q,e,"f"),sO(this,Z,t,"f")}),"f"),s$(this,V,"f").catch(()=>{}),s$(this,Y,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},s$(this,K,"m",ei).bind(this))},0)}_connected(){this.ended||(s$(this,G,"f").call(this),this._emit("connect"))}get ended(){return s$(this,et,"f")}get errored(){return s$(this,es,"f")}get aborted(){return s$(this,er,"f")}abort(){this.controller.abort()}on(e,t){return(s$(this,ee,"f")[e]||(s$(this,ee,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=s$(this,ee,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(s$(this,ee,"f")[e]||(s$(this,ee,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{sO(this,en,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){sO(this,en,!0,"f"),await s$(this,Y,"f")}_emit(e,...t){if(s$(this,et,"f"))return;"end"===e&&(sO(this,et,!0,"f"),s$(this,Q,"f").call(this));let s=s$(this,ee,"f")[e];if(s&&(s$(this,ee,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];s$(this,en,"f")||s?.length||Promise.reject(e),s$(this,X,"f").call(this,e),s$(this,Z,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];s$(this,en,"f")||s?.length||Promise.reject(e),s$(this,X,"f").call(this,e),s$(this,Z,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function sj(e){return e?.$brand==="auto-parseable-response-format"}function sC(e){return e?.$brand==="auto-parseable-tool"}function sI(e,t){let s=e.choices.map(e=>{var s,r;if("length"===e.finish_reason)throw new J;if("content_filter"===e.finish_reason)throw new W;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:sC(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,r=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:s}}function sL(e){return!!sj(e.response_format)||(e.tools?.some(e=>sC(e)||"function"===e.type&&!0===e.function.strict)??!1)}V=new WeakMap,G=new WeakMap,X=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,er=new WeakMap,en=new WeakMap,K=new WeakSet,ei=function(e){if(sO(this,es,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new j),e instanceof j)return sO(this,er,!0,"f"),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){let t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))};var sU=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};class sB extends sR{constructor(){super(...arguments),ea.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(sT(e)||sP(e))&&e.content)this._emit("functionCallResult",e.content);else if(sA(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(sA(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new $("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),sU(this,ea,"m",eo).call(this)}async finalMessage(){return await this.done(),sU(this,ea,"m",el).call(this)}async finalFunctionCall(){return await this.done(),sU(this,ea,"m",eh).call(this)}async finalFunctionCallResult(){return await this.done(),sU(this,ea,"m",ec).call(this)}async totalUsage(){return await this.done(),sU(this,ea,"m",eu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=sU(this,ea,"m",el).call(this);t&&this._emit("finalMessage",t);let s=sU(this,ea,"m",eo).call(this);s&&this._emit("finalContent",s);let r=sU(this,ea,"m",eh).call(this);r&&this._emit("finalFunctionCall",r);let n=sU(this,ea,"m",ec).call(this);null!=n&&this._emit("finalFunctionCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",sU(this,ea,"m",eu).call(this))}async _createChatCompletion(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),sU(this,ea,"m",ed).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sI(n,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){let r="function",{function_call:n="auto",stream:i,...a}=t,o="string"!=typeof n&&n?.name,{maxChatCompletions:l=10}=s||{},h={};for(let e of t.functions)h[e.name||e.function.name]=e;let c=t.functions.map(e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description}));for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t,i=await this._createChatCompletion(e,{...a,function_call:n,functions:c,messages:[...this.messages]},s),l=i.choices[0]?.message;if(!l)throw new $("missing message in ChatCompletion response");if(!l.function_call)return;let{name:u,arguments:d}=l.function_call,f=h[u];if(f){if(o&&o!==u){let e=`Invalid function_call: ${JSON.stringify(u)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,name:u,content:e});continue}}else{let e=`Invalid function_call: ${JSON.stringify(u)}. Available options are: ${c.map(e=>JSON.stringify(e.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:u,content:e});continue}try{t=sE(f)?await f.parse(d):d}catch(e){this._addMessage({role:r,name:u,content:e instanceof Error?e.message:String(e)});continue}let p=await f.function(t,this),g=sU(this,ea,"m",ef).call(this,p);if(this._addMessage({role:r,name:u,content:g}),o)return}}async _runTools(e,t,s){let r="tool",{tool_choice:n="auto",stream:i,...a}=t,o="string"!=typeof n&&n?.function?.name,{maxChatCompletions:l=10}=s||{},h=t.tools.map(e=>{if(sC(e)){if(!e.$callback)throw new $("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),c={};for(let e of h)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);let u="tools"in t?h.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:n,tools:u,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new $("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:n,arguments:i}=e.function,a=c[n];if(a){if(o&&o!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(c).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}try{t=sE(a)?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:r,tool_call_id:s,content:e});continue}let l=await a.function(t,this),h=sU(this,ea,"m",ef).call(this,l);if(this._addMessage({role:r,tool_call_id:s,content:h}),o)return}}}}ea=new WeakSet,eo=function(){return sU(this,ea,"m",el).call(this).content??null},el=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(sA(t)){let{function_call:e,...s}=t,r={...s,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new $("stream ended without producing a ChatCompletionMessage with role=assistant")},eh=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sA(t)&&t?.function_call)return t.function_call;if(sA(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},ec=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sT(t)&&null!=t.content||sP(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},eu=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ed=function(e){if(null!=e.n&&e.n>1)throw new $("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ef=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sN extends sB{static runFunctions(e,t,s){let r=new sN,n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,n)),r}static runTools(e,t,s){let r=new sN,n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}_addMessage(e,t=!0){super._addMessage(e,t),sA(e)&&e.content&&this._emit("content",e.content)}}let sD={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sM extends Error{}class sF extends Error{}let sq=(e,t)=>{let s=e.length,r=0,n=e=>{throw new sM(`${e} at position ${r}`)},i=e=>{throw new sF(`${e} at position ${r}`)},a=()=>(u(),r>=s&&n("Unexpected end of input"),'"'===e[r])?o():"{"===e[r]?l():"["===e[r]?h():"null"===e.substring(r,r+4)||sD.NULL&t&&s-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||sD.BOOL&t&&s-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||sD.BOOL&t&&s-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||sD.INFINITY&t&&s-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||sD.MINUS_INFINITY&t&&1<s-r&&s-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||sD.NAN&t&&s-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):c(),o=()=>{let a=r,o=!1;for(r++;r<s&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(a,++r-Number(o)))}catch(e){i(String(e))}else if(sD.STR&t)try{return JSON.parse(e.substring(a,r-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},l=()=>{r++,u();let i={};try{for(;"}"!==e[r];){if(u(),r>=s&&sD.OBJ&t)return i;let n=o();u(),r++;try{let e=a();Object.defineProperty(i,n,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sD.OBJ&t)return i;throw e}u(),","===e[r]&&r++}}catch(e){if(sD.OBJ&t)return i;n("Expected '}' at end of object")}return r++,i},h=()=>{r++;let s=[];try{for(;"]"!==e[r];)s.push(a()),u(),","===e[r]&&r++}catch(e){if(sD.ARR&t)return s;n("Expected ']' at end of array")}return r++,s},c=()=>{if(0===r){"-"===e&&sD.NUM&t&&n("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sD.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=s||sD.NUM&t||n("Unterminated number literal");try{return JSON.parse(e.substring(a,r))}catch(s){"-"===e.substring(a,r)&&sD.NUM&t&&n("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},u=()=>{for(;r<s&&" \n\r	".includes(e[r]);)r++};return a()},sJ=e=>(function(e,t=sD.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sq(e.trim(),t)})(e,sD.ALL^sD.NUM);var sW=function(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},sH=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};class sz extends sB{constructor(e){super(),ep.add(this),eg.set(this,void 0),em.set(this,void 0),ey.set(this,void 0),sW(this,eg,e,"f"),sW(this,em,[],"f")}get currentChatCompletionSnapshot(){return sH(this,ey,"f")}static fromReadableStream(e){let t=new sz(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let r=new sz(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){super._createChatCompletion;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),sH(this,ep,"m",ew).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),n))sH(this,ep,"m",eb).call(this,e);if(n.controller.signal?.aborted)throw new j;return this._addChatCompletion(sH(this,ep,"m",eS).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),sH(this,ep,"m",ew).call(this),this._connected();let n=e4.fromReadableStream(e,this.controller);for await(let e of n)s&&s!==e.id&&this._addChatCompletion(sH(this,ep,"m",eS).call(this)),sH(this,ep,"m",eb).call(this,e),s=e.id;if(n.controller.signal?.aborted)throw new j;return this._addChatCompletion(sH(this,ep,"m",eS).call(this))}[(eg=new WeakMap,em=new WeakMap,ey=new WeakMap,ep=new WeakSet,ew=function(){this.ended||sW(this,ey,void 0,"f")},e_=function(e){let t=sH(this,em,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},sH(this,em,"f")[e.index]=t),t},eb=function(e){if(this.ended)return;let t=sH(this,ep,"m",eE).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=sH(this,ep,"m",e_).call(this,e);for(let t of(e.finish_reason&&(sH(this,ep,"m",ek).call(this,e),null!=r.current_tool_call_index&&sH(this,ep,"m",ev).call(this,e,r.current_tool_call_index)),s.delta.tool_calls??[]))r.current_tool_call_index!==t.index&&(sH(this,ep,"m",ek).call(this,e),null!=r.current_tool_call_index&&sH(this,ep,"m",ev).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},ev=function(e,t){if(sH(this,ep,"m",e_).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=sH(this,eg,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:sC(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},ek=function(e){let t=sH(this,ep,"m",e_).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=sH(this,ep,"m",ex).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},eS=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");let e=sH(this,ey,"f");if(!e)throw new $("request ended without sending any chunks");return sW(this,ey,void 0,"f"),sW(this,em,[],"f"),function(e,t){var s;let{id:r,choices:n,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:r,choices:n.map(({message:t,finish_reason:s,index:r,logprobs:n,...i})=>{if(!s)throw new $(`missing finish_reason for choice ${r}`);let{content:a=null,function_call:o,tool_calls:l,...h}=t,c=t.role;if(!c)throw new $(`missing role for choice ${r}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new $(`missing function_call.arguments for choice ${r}`);if(!l)throw new $(`missing function_call.name for choice ${r}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}return l?{...i,index:r,finish_reason:s,logprobs:n,message:{...h,role:c,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:n,type:i,id:a,...o}=t,{arguments:l,name:h,...c}=n||{};if(null==a)throw new $(`missing choices[${r}].tool_calls[${s}].id
${sK(e)}`);if(null==i)throw new $(`missing choices[${r}].tool_calls[${s}].type
${sK(e)}`);if(null==h)throw new $(`missing choices[${r}].tool_calls[${s}].function.name
${sK(e)}`);if(null==l)throw new $(`missing choices[${r}].tool_calls[${s}].function.arguments
${sK(e)}`);return{...o,id:a,type:i,function:{...c,name:h,arguments:l}}})}}:{...i,message:{...h,content:a,role:c,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&sL(t)?sI(s,t):{...s,choices:s.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,sH(this,eg,"f"))},ex=function(){let e=sH(this,eg,"f")?.response_format;return sj(e)?e:null},eE=function(e){var t,s,r,n;let i=sH(this,ey,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:h,logprobs:c=null,...u}of(i?Object.assign(i,o):i=sW(this,ey,{...o,choices:[]},"f"),e.choices)){let e=i.choices[h];if(e||(e=i.choices[h]={finish_reason:l,index:h,message:{},logprobs:c,...u}),c)if(e.logprobs){let{content:r,refusal:n,...i}=c;Object.assign(e.logprobs,i),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),n&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},c);if(l&&(e.finish_reason=l,sH(this,eg,"f")&&sL(sH(this,eg,"f")))){if("length"===l)throw new J;if("content_filter"===l)throw new W}if(Object.assign(e,u),!a)continue;let{content:o,refusal:d,function_call:f,role:p,tool_calls:g,...m}=a;if(Object.assign(e.message,m),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&sH(this,ep,"m",ex).call(this)&&(e.message.parsed=sJ(e.message.content))),g)for(let{index:t,id:s,type:r,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),g)){let o=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(o,a),s&&(o.id=s),r&&(o.type=r),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e)return!1;let s=e.tools?.find(e=>e.function?.name===t.function.name);return sC(s)||s?.function.strict||!1}(sH(this,eg,"f"),o)&&(o.function.parsed_arguments=sJ(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new e4(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sK(e){return JSON.stringify(e)}class sV extends sz{static fromReadableStream(e){let t=new sV(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,s){let r=new sV(null),n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,n)),r}static runTools(e,t,s){let r=new sV(t),n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}}class sG extends tX{parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new $(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new $(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(t=>sI(t,e))}runFunctions(e,t){return e.stream?sV.runFunctions(this._client,e,t):sN.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?sV.runTools(this._client,e,t):sN.runTools(this._client,e,t)}stream(e,t){return sz.createChatCompletion(this._client,e,t)}}class sX extends tX{constructor(){super(...arguments),this.completions=new sG(this._client)}}(sX||(sX={})).Completions=sG;class sY extends tX{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class sQ extends tX{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class sZ extends tX{constructor(){super(...arguments),this.sessions=new sY(this._client),this.transcriptionSessions=new sQ(this._client)}}sZ.Sessions=sY,sZ.TranscriptionSessions=sQ;var s0=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)},s1=function(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s};class s2 extends sR{constructor(){super(...arguments),eA.add(this),eT.set(this,[]),eP.set(this,{}),eO.set(this,{}),e$.set(this,void 0),eR.set(this,void 0),ej.set(this,void 0),eC.set(this,void 0),eI.set(this,void 0),eL.set(this,void 0),eU.set(this,void 0),eB.set(this,void 0),eN.set(this,void 0)}[(eT=new WeakMap,eP=new WeakMap,eO=new WeakMap,e$=new WeakMap,eR=new WeakMap,ej=new WeakMap,eC=new WeakMap,eI=new WeakMap,eL=new WeakMap,eU=new WeakMap,eB=new WeakMap,eN=new WeakMap,eA=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new s2;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=e4.fromReadableStream(e,this.controller);for await(let e of r)s0(this,eA,"m",eD).call(this,e);if(r.controller.signal?.aborted)throw new j;return this._addRun(s0(this,eA,"m",eM).call(this))}toReadableStream(){return new e4(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r,n){let i=new s2;return i._run(()=>i._runToolAssistantStream(e,t,s,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,s,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},o=await e.submitToolOutputs(t,s,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),o))s0(this,eA,"m",eD).call(this,e);if(o.controller.signal?.aborted)throw new j;return this._addRun(s0(this,eA,"m",eM).call(this))}static createThreadAssistantStream(e,t,s){let r=new s2;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){let n=new s2;return n._run(()=>n._runAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return s0(this,eU,"f")}currentRun(){return s0(this,eB,"f")}currentMessageSnapshot(){return s0(this,e$,"f")}currentRunStepSnapshot(){return s0(this,eN,"f")}async finalRunSteps(){return await this.done(),Object.values(s0(this,eP,"f"))}async finalMessages(){return await this.done(),Object.values(s0(this,eO,"f"))}async finalRun(){if(await this.done(),!s0(this,eR,"f"))throw Error("Final run was not received.");return s0(this,eR,"f")}async _createThreadAssistantStream(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},i=await e.createAndRun(n,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))s0(this,eA,"m",eD).call(this,e);if(i.controller.signal?.aborted)throw new j;return this._addRun(s0(this,eA,"m",eM).call(this))}async _createAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))s0(this,eA,"m",eD).call(this,e);if(a.controller.signal?.aborted)throw new j;return this._addRun(s0(this,eA,"m",eM).call(this))}static accumulateDelta(e,t){for(let[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=r;continue}if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else if(tG(t)&&tG(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(let e of r){if(!tG(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let r=t[s];null==r?t.push(e):t[s]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r,n){return await this._createToolAssistantStream(s,e,t,r,n)}}eD=function(e){if(!this.ended)switch(s1(this,eU,e,"f"),s0(this,eA,"m",eJ).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":s0(this,eA,"m",eK).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":s0(this,eA,"m",eq).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":s0(this,eA,"m",eF).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},eM=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");if(!s0(this,eR,"f"))throw Error("Final run has not been received");return s0(this,eR,"f")},eF=function(e){let[t,s]=s0(this,eA,"m",eH).call(this,e,s0(this,e$,"f"));for(let e of(s1(this,e$,t,"f"),s0(this,eO,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,r=t.content[s.index];if(r&&"text"==r.type)this._emit("textDelta",e,r.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=s0(this,ej,"f")){if(s0(this,eC,"f"))switch(s0(this,eC,"f").type){case"text":this._emit("textDone",s0(this,eC,"f").text,s0(this,e$,"f"));break;case"image_file":this._emit("imageFileDone",s0(this,eC,"f").image_file,s0(this,e$,"f"))}s1(this,ej,s.index,"f")}s1(this,eC,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==s0(this,ej,"f")){let t=e.data.content[s0(this,ej,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,s0(this,e$,"f"));break;case"text":this._emit("textDone",t.text,s0(this,e$,"f"))}}s0(this,e$,"f")&&this._emit("messageDone",e.data),s1(this,e$,void 0,"f")}},eq=function(e){let t=s0(this,eA,"m",eW).call(this,e);switch(s1(this,eN,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==s0(this,eI,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(s0(this,eL,"f")&&this._emit("toolCallDone",s0(this,eL,"f")),s1(this,eI,e.index,"f"),s1(this,eL,t.step_details.tool_calls[e.index],"f"),s0(this,eL,"f")&&this._emit("toolCallCreated",s0(this,eL,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":s1(this,eN,void 0,"f"),"tool_calls"==e.data.step_details.type&&s0(this,eL,"f")&&(this._emit("toolCallDone",s0(this,eL,"f")),s1(this,eL,void 0,"f")),this._emit("runStepDone",e.data,t)}},eJ=function(e){s0(this,eT,"f").push(e),this._emit("event",e)},eW=function(e){switch(e.event){case"thread.run.step.created":return s0(this,eP,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=s0(this,eP,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let r=s2.accumulateDelta(t,s.delta);s0(this,eP,"f")[e.data.id]=r}return s0(this,eP,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":s0(this,eP,"f")[e.data.id]=e.data}if(s0(this,eP,"f")[e.data.id])return s0(this,eP,"f")[e.data.id];throw Error("No snapshot available")},eH=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=s0(this,eA,"m",ez).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ez=function(e,t){return s2.accumulateDelta(t,e)},eK=function(e){switch(s1(this,eB,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":s1(this,eR,e.data,"f"),s0(this,eL,"f")&&(this._emit("toolCallDone",s0(this,eL,"f")),s1(this,eL,void 0,"f"))}};class s8 extends tX{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,s6,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class s6 extends t0{}s8.MessagesPage=s6;class s5 extends tX{retrieve(e,t,s,r={},n){return tT(r)?this.retrieve(e,t,s,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t,s={},r){return tT(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,s3,{query:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class s3 extends t0{}s5.RunStepsPage=s3;class s4 extends tX{constructor(){super(...arguments),this.steps=new s5(this._client)}create(e,t,s){let{include:r,...n}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,s9,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}createAndStream(e,t,s){return s2.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let r={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let{data:n,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...r}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await tL(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,s){return s2.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,r){let n=await this.submitToolOutputs(e,t,s,r);return await this.poll(e,n.id,r)}submitToolOutputsStream(e,t,s,r){return s2.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,r)}}class s9 extends t0{}s4.RunsPage=s9,s4.Steps=s5,s4.RunStepsPage=s3;class s7 extends tX{constructor(){super(...arguments),this.runs=new s4(this._client),this.messages=new s8(this._client)}create(e={},t){return tT(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return s2.createThreadAssistantStream(e,this._client.beta.threads,t)}}s7.Runs=s4,s7.RunsPage=s9,s7.Messages=s8,s7.MessagesPage=s6;class re extends tX{constructor(){super(...arguments),this.realtime=new sZ(this._client),this.chat=new sX(this._client),this.assistants=new sS(this._client),this.threads=new s7(this._client)}}re.Realtime=sZ,re.Assistants=sS,re.AssistantsPage=sx,re.Threads=s7;class rt extends tX{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/batches",rs,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class rs extends t0{}rt.BatchesPage=rs;class rr extends tX{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,tu({body:t,...s}))}}class rn extends tX{constructor(){super(...arguments),this.parts=new rr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}function ri(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){let s=function(e,t){return e.find(e=>"function"===e.type&&e.name===t)}(e.tools??[],t.name);return{...t,...t,parsed_arguments:function(e){return e?.$brand==="auto-parseable-tool"}(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,r;return"output_text"===e.type?{...e,parsed:(s=t,r=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:s}}return e}),r=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||ra(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let e of r.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),r}rn.Parts=rr;function ra(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class ro extends tX{list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,rd,{query:t,...s})}}var rl=function(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},rh=function(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};class rc extends sR{constructor(e){super(),eV.add(this),eG.set(this,void 0),eX.set(this,void 0),eY.set(this,void 0),rl(this,eG,e,"f")}static createResponse(e,t,s){let r=new rc(t);return r._run(()=>r._createResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createResponse(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),rh(this,eV,"m",eQ).call(this);let n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),n))rh(this,eV,"m",eZ).call(this,e);if(n.controller.signal?.aborted)throw new j;return rh(this,eV,"m",e0).call(this)}[(eG=new WeakMap,eX=new WeakMap,eY=new WeakMap,eV=new WeakSet,eQ=function(){this.ended||rl(this,eX,void 0,"f")},eZ=function(e){if(this.ended)return;let t=rh(this,eV,"m",e1).call(this,e);switch(this._emit("event",e),e.type){case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new $(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new $(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new $(`expected content to be 'output_text', got ${t.type}`);this._emit("response.output_text.delta",{...e,snapshot:t.text})}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new $(`missing output at index ${e.output_index}`);"function_call"===s.type&&this._emit("response.function_call_arguments.delta",{...e,snapshot:s.arguments});break}default:this._emit(e.type,e)}},e0=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");let e=rh(this,eX,"f");if(!e)throw new $("request ended without sending any events");rl(this,eX,void 0,"f");let t=function(e,t){var s;return t&&(s=t,sj(s.text?.format))?ri(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,rh(this,eG,"f"));return rl(this,eY,t,"f"),t},e1=function(e){let t=rh(this,eX,"f");if(!t){if("response.created"!==e.type)throw new $(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return rl(this,eX,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new $(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new $(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new $(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new $(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new $(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":rl(this,eX,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=rh(this,eY,"f");if(!e)throw new $("stream ended without producing a ChatCompletion");return e}}class ru extends tX{constructor(){super(...arguments),this.inputItems=new ro(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&ra(e),e))}retrieve(e,t={},s){return tT(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...s})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>ri(t,e))}stream(e,t){return rc.createResponse(this._client,e,t)}}class rd extends t0{}ru.InputItems=ro;class rf extends tX{retrieve(e,t,s,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${s}`,r)}list(e,t,s={},r){return tT(s)?this.list(e,t,{},s):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,rp,{query:s,...r})}}class rp extends t0{}rf.OutputItemListResponsesPage=rp;class rg extends tX{constructor(){super(...arguments),this.outputItems=new rf(this._client)}create(e,t,s){return this._client.post(`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){return this._client.get(`/evals/${e}/runs/${t}`,s)}list(e,t={},s){return tT(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,rm,{query:t,...s})}del(e,t,s){return this._client.delete(`/evals/${e}/runs/${t}`,s)}cancel(e,t,s){return this._client.post(`/evals/${e}/runs/${t}`,s)}}class rm extends t0{}rg.RunListResponsesPage=rm,rg.OutputItems=rf,rg.OutputItemListResponsesPage=rp;class ry extends tX{constructor(){super(...arguments),this.runs=new rg(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,s){return this._client.post(`/evals/${e}`,{body:t,...s})}list(e={},t){return tT(e)?this.list({},e):this._client.getAPIList("/evals",rw,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class rw extends t0{}ry.EvalListResponsesPage=rw,ry.Runs=rg,ry.RunListResponsesPage=rm,s(9509);class r_ extends tk{constructor({baseURL:e=tN("OPENAI_BASE_URL"),apiKey:t=tN("OPENAI_API_KEY"),organization:s=tN("OPENAI_ORG_ID")??null,project:r=tN("OPENAI_PROJECT_ID")??null,...n}={}){if(void 0===t)throw new $("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:s,project:r,...n,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&tH())throw new $("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new tY(this),this.chat=new t6(this),this.embeddings=new t5(this),this.files=new t3(this),this.images=new t9(this),this.audio=new ss(this),this.moderations=new sr(this),this.models=new sn(this),this.fineTuning=new sp(this),this.vectorStores=new sb(this),this.beta=new re(this),this.batches=new rt(this),this.uploads=new rn(this),this.responses=new ru(this),this.evals=new ry(this),this._options=i,this.apiKey=t,this.organization=s,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let s,r,n=e,i=function(e=x){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||x.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=f;if(void 0!==e.format){if(!w.call(p,e.format))throw TypeError("Unknown format option provided.");r=e.format}let n=p[r],i=x.filter;if(("function"==typeof e.filter||b(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in _?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":x.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||x.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:x.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:x.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:x.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?x.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:x.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:x.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:x.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:x.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:x.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:x.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:x.strictNullHandling}}(t);"function"==typeof i.filter?n=(0,i.filter)("",n):b(i.filter)&&(s=i.filter);let a=[];if("object"!=typeof n||null===n)return"";let o=_[i.arrayFormat],l="comma"===o&&i.commaRoundTrip;s||(s=Object.keys(n)),i.sort&&s.sort(i.sort);let h=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];i.skipNulls&&null===n[t]||k(a,function e(t,s,r,n,i,a,o,l,h,c,u,d,f,p,g,m,w,_){var v,S;let A,T=t,P=_,O=0,$=!1;for(;void 0!==(P=P.get(E))&&!$;){let e=P.get(t);if(O+=1,void 0!==e)if(e===O)throw RangeError("Cyclic object value");else $=!0;void 0===P.get(E)&&(O=0)}if("function"==typeof c?T=c(s,T):T instanceof Date?T=f?.(T):"comma"===r&&b(T)&&(T=y(T,function(e){return e instanceof Date?f?.(e):e})),null===T){if(a)return h&&!m?h(s,x.encoder,w,"key",p):s;T=""}if("string"==typeof(v=T)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||(S=T)&&"object"==typeof S&&S.constructor&&S.constructor.isBuffer&&S.constructor.isBuffer(S)){if(h){let e=m?s:h(s,x.encoder,w,"key",p);return[g?.(e)+"="+g?.(h(T,x.encoder,w,"value",p))]}return[g?.(s)+"="+g?.(String(T))]}let R=[];if(void 0===T)return R;if("comma"===r&&b(T))m&&h&&(T=y(T,h)),A=[{value:T.length>0?T.join(",")||null:void 0}];else if(b(c))A=c;else{let e=Object.keys(T);A=u?e.sort(u):e}let j=l?String(s).replace(/\./g,"%2E"):String(s),C=n&&b(T)&&1===T.length?j+"[]":j;if(i&&b(T)&&0===T.length)return C+"[]";for(let s=0;s<A.length;++s){let y=A[s],v="object"==typeof y&&void 0!==y.value?y.value:T[y];if(o&&null===v)continue;let S=d&&l?y.replace(/\./g,"%2E"):y,x=b(T)?"function"==typeof r?r(C,S):C:C+(d?"."+S:"["+S+"]");_.set(t,O);let P=new WeakMap;P.set(E,_),k(R,e(v,x,r,n,i,a,o,l,"comma"===r&&m&&b(T)?null:h,c,u,d,f,p,g,m,w,P))}return R}(n[t],t,o,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,h))}let c=a.join(i.delimiter),u=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}}r_.OpenAI=r_,r_.DEFAULT_TIMEOUT=6e5,r_.OpenAIError=$,r_.APIError=R,r_.APIConnectionError=C,r_.APIConnectionTimeoutError=I,r_.APIUserAbortError=j,r_.NotFoundError=N,r_.ConflictError=D,r_.RateLimitError=F,r_.BadRequestError=L,r_.AuthenticationError=U,r_.InternalServerError=q,r_.PermissionDeniedError=B,r_.UnprocessableEntityError=M,r_.toFile=ta,r_.fileFromPath=u,r_.Completions=tY,r_.Chat=t6,r_.ChatCompletionsPage=t2,r_.Embeddings=t5,r_.Files=t3,r_.FileObjectsPage=t4,r_.Images=t9,r_.Audio=ss,r_.Moderations=sr,r_.Models=sn,r_.ModelsPage=si,r_.FineTuning=sp,r_.VectorStores=sb,r_.VectorStoresPage=sv,r_.VectorStoreSearchResponsesPage=sk,r_.Beta=re,r_.Batches=rt,r_.BatchesPage=rs,r_.Uploads=rn,r_.Responses=ru,r_.Evals=ry,r_.EvalListResponsesPage=rw},5068:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(s(3280));class i{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){let r=!1,i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e)).join("");return this.url.searchParams.set("select",i),s&&(this.headers.Prefer=`count=${s}`),new n.default({method:t?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){let r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new n.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:i=!0}={}){let a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),r&&a.push(`count=${r}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new n.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){let s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new n.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new n.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}t.default=i},5171:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_HEADERS=void 0;let r=s(182);t.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`}},5646:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;let n=r(s(9936));t.PostgrestClient=n.default;let i=r(s(5068));t.PostgrestQueryBuilder=i.default;let a=r(s(3280));t.PostgrestFilterBuilder=a.default;let o=r(s(7156));t.PostgrestTransformBuilder=o.default;let l=r(s(9286));t.PostgrestBuilder=l.default;let h=r(s(1971));t.PostgrestError=h.default,t.default={PostgrestClient:n.default,PostgrestQueryBuilder:i.default,PostgrestFilterBuilder:a.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:h.default}},7156:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(s(9286));class i extends n.default{select(e){let t=!1,s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:n=r}={}){let i=n?`${n}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){let r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){let n=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:n=!1,format:i="text"}={}){var a;let o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!=(a=this.headers.Accept)?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!=(e=this.headers.Prefer)?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}t.default=i},9286:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(s(2410)),i=r(s(1971));class a{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=n.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,r;let n=null,a=null,o=null,l=e.status,h=e.statusText;if(e.ok){if("HEAD"!==this.method){let t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}let r=null==(t=this.headers.Prefer)?void 0:t.match(/count=(exact|planned|estimated)/),i=null==(s=e.headers.get("content-range"))?void 0:s.split("/");r&&i&&i.length>1&&(o=parseInt(i[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(n={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,o=null,l=406,h="Not Acceptable"):a=1===a.length?a[0]:null)}else{let t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(a=[],n=null,l=200,h="OK")}catch(s){404===e.status&&""===t?(l=204,h="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null==(r=null==n?void 0:n.details)?void 0:r.includes("0 rows"))&&(n=null,l=200,h="OK"),n&&this.shouldThrowOnError)throw new i.default(n)}return{error:n,data:a,count:o,status:l,statusText:h}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!=(t=null==e?void 0:e.name)?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!=(s=null==e?void 0:e.stack)?s:""}`,hint:"",code:`${null!=(r=null==e?void 0:e.code)?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}}t.default=a},9641:e=>{!function(){var t={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),s=t[0],r=t[1];return(s+r)*3/4-r},t.toByteArray=function(e){var t,s,i=l(e),a=i[0],o=i[1],h=new n((a+o)*3/4-o),c=0,u=o>0?a-4:a;for(s=0;s<u;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],h[c++]=t>>16&255,h[c++]=t>>8&255,h[c++]=255&t;return 2===o&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,h[c++]=255&t),1===o&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,h[c++]=t>>8&255,h[c++]=255&t),h},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i=[],a=0,o=r-n;a<o;a+=16383)i.push(function(e,t,r){for(var n,i=[],a=t;a<r;a+=3)n=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(s[n>>18&63]+s[n>>12&63]+s[n>>6&63]+s[63&n]);return i.join("")}(e,a,a+16383>o?o:a+16383));return 1===n?i.push(s[(t=e[r-1])>>2]+s[t<<4&63]+"=="):2===n&&i.push(s[(t=(e[r-2]<<8)+e[r-1])>>10]+s[t>>4&63]+s[t<<2&63]+"="),i.join("")};for(var s=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=i.length;a<o;++a)s[a]=i[a],r[i.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");-1===s&&(s=t);var r=s===t?0:4-s%4;return[s,r]}r[45]=62,r[95]=63},72:function(e,t,s){"use strict";var r=s(675),n=s(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,s){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return l(e,t,s)}function l(e,t,s){if("string"==typeof e){var r=e,n=t;if(("string"!=typeof n||""===n)&&(n="utf8"),!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);var i=0|f(r,n),l=a(i),h=l.write(r,n);return h!==i&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(O(e,ArrayBuffer)||e&&O(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(O(e,SharedArrayBuffer)||e&&O(e.buffer,SharedArrayBuffer)))return function(e,t,s){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(s||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===s?new Uint8Array(e):void 0===s?new Uint8Array(e,t):new Uint8Array(e,t,s),o.prototype),r}(e,t,s);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var c=e.valueOf&&e.valueOf();if(null!=c&&c!==e)return o.from(c,t,s);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),s=a(t);return 0===s.length||e.copy(s,0,0,t),s}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):u(e):"Buffer"===e.type&&Array.isArray(e.data)?u(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,s);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return h(e),a(e<0?0:0|d(e))}function u(e){for(var t=e.length<0?0:0|d(e.length),s=a(t),r=0;r<t;r+=1)s[r]=255&e[r];return s}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,s){return l(e,t,s)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,s){return(h(e),e<=0)?a(e):void 0!==t?"string"==typeof s?a(e).fill(t,s):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||O(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var s=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===s)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return E(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return T(e).length;default:if(n)return r?-1:E(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,s){var n,i,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===s||s>this.length)&&(s=this.length),s<=0||(s>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,s){var r=e.length;(!t||t<0)&&(t=0),(!s||s<0||s>r)&&(s=r);for(var n="",i=t;i<s;++i)n+=$[e[i]];return n}(this,t,s);case"utf8":case"utf-8":return w(this,t,s);case"ascii":return function(e,t,s){var r="";s=Math.min(e.length,s);for(var n=t;n<s;++n)r+=String.fromCharCode(127&e[n]);return r}(this,t,s);case"latin1":case"binary":return function(e,t,s){var r="";s=Math.min(e.length,s);for(var n=t;n<s;++n)r+=String.fromCharCode(e[n]);return r}(this,t,s);case"base64":return n=this,i=t,a=s,0===i&&a===n.length?r.fromByteArray(n):r.fromByteArray(n.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,s){for(var r=e.slice(t,s),n="",i=0;i<r.length;i+=2)n+=String.fromCharCode(r[i]+256*r[i+1]);return n}(this,t,s);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,s){var r=e[t];e[t]=e[s],e[s]=r}function m(e,t,s,r,n){var i;if(0===e.length)return -1;if("string"==typeof s?(r=s,s=0):s>0x7fffffff?s=0x7fffffff:s<-0x80000000&&(s=-0x80000000),(i=s*=1)!=i&&(s=n?0:e.length-1),s<0&&(s=e.length+s),s>=e.length)if(n)return -1;else s=e.length-1;else if(s<0)if(!n)return -1;else s=0;if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,s,r,n);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(n)return Uint8Array.prototype.indexOf.call(e,t,s);else return Uint8Array.prototype.lastIndexOf.call(e,t,s);return y(e,[t],s,r,n)}throw TypeError("val must be string, number or Buffer")}function y(e,t,s,r,n){var i,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,s/=2}function h(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var c=-1;for(i=s;i<o;i++)if(h(e,i)===h(t,-1===c?0:i-c)){if(-1===c&&(c=i),i-c+1===l)return c*a}else -1!==c&&(i-=i-c),c=-1}else for(s+l>o&&(s=o-l),i=s;i>=0;i--){for(var u=!0,d=0;d<l;d++)if(h(e,i+d)!==h(t,d)){u=!1;break}if(u)return i}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(O(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),O(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var s=e.length,r=t.length,n=0,i=Math.min(s,r);n<i;++n)if(e[n]!==t[n]){s=e[n],r=t[n];break}return s<r?-1:+(r<s)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(s=0,t=0;s<e.length;++s)t+=e[s].length;var s,r=o.allocUnsafe(t),n=0;for(s=0;s<e.length;++s){var i=e[s];if(O(i,Uint8Array)&&(i=o.from(i)),!o.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(r,n),n+=i.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",s=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(e+=" ... "),"<Buffer "+e+">"},i&&(o.prototype[i]=o.prototype.inspect),o.prototype.compare=function(e,t,s,r,n){if(O(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===s&&(s=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||s>e.length||r<0||n>this.length)throw RangeError("out of range index");if(r>=n&&t>=s)return 0;if(r>=n)return -1;if(t>=s)return 1;if(t>>>=0,s>>>=0,r>>>=0,n>>>=0,this===e)return 0;for(var i=n-r,a=s-t,l=Math.min(i,a),h=this.slice(r,n),c=e.slice(t,s),u=0;u<l;++u)if(h[u]!==c[u]){i=h[u],a=c[u];break}return i<a?-1:+(a<i)},o.prototype.includes=function(e,t,s){return -1!==this.indexOf(e,t,s)},o.prototype.indexOf=function(e,t,s){return m(this,e,t,s,!0)},o.prototype.lastIndexOf=function(e,t,s){return m(this,e,t,s,!1)};function w(e,t,s){s=Math.min(e.length,s);for(var r=[],n=t;n<s;){var i,a,o,l,h=e[n],c=null,u=h>239?4:h>223?3:h>191?2:1;if(n+u<=s)switch(u){case 1:h<128&&(c=h);break;case 2:(192&(i=e[n+1]))==128&&(l=(31&h)<<6|63&i)>127&&(c=l);break;case 3:i=e[n+1],a=e[n+2],(192&i)==128&&(192&a)==128&&(l=(15&h)<<12|(63&i)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:i=e[n+1],a=e[n+2],o=e[n+3],(192&i)==128&&(192&a)==128&&(192&o)==128&&(l=(15&h)<<18|(63&i)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=u}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function _(e,t,s){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>s)throw RangeError("Trying to access beyond buffer length")}function b(e,t,s,r,n,i){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<i)throw RangeError('"value" argument is out of bounds');if(s+r>e.length)throw RangeError("Index out of range")}function v(e,t,s,r,n,i){if(s+r>e.length||s<0)throw RangeError("Index out of range")}function k(e,t,s,r,i){return t*=1,s>>>=0,i||v(e,t,s,4,34028234663852886e22,-34028234663852886e22),n.write(e,t,s,r,23,4),s+4}function S(e,t,s,r,i){return t*=1,s>>>=0,i||v(e,t,s,8,17976931348623157e292,-17976931348623157e292),n.write(e,t,s,r,52,8),s+8}o.prototype.write=function(e,t,s,r){if(void 0===t)r="utf8",s=this.length,t=0;else if(void 0===s&&"string"==typeof t)r=t,s=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(s)?(s>>>=0,void 0===r&&(r="utf8")):(r=s,s=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var n,i,a,o,l,h,c,u,d=this.length-t;if((void 0===s||s>d)&&(s=d),e.length>0&&(s<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,s,r){s=Number(s)||0;var n=e.length-s;r?(r=Number(r))>n&&(r=n):r=n;var i=t.length;r>i/2&&(r=i/2);for(var a=0;a<r;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[s+a]=l}return a}(this,e,t,s);case"utf8":case"utf-8":return n=t,i=s,P(E(e,this.length-n),this,n,i);case"ascii":return a=t,o=s,P(A(e),this,a,o);case"latin1":case"binary":return function(e,t,s,r){return P(A(t),e,s,r)}(this,e,t,s);case"base64":return l=t,h=s,P(T(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,u=s,P(function(e,t){for(var s,r,n=[],i=0;i<e.length&&!((t-=2)<0);++i)r=(s=e.charCodeAt(i))>>8,n.push(s%256),n.push(r);return n}(e,this.length-c),this,c,u);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var s=this.length;e=~~e,t=void 0===t?s:~~t,e<0?(e+=s)<0&&(e=0):e>s&&(e=s),t<0?(t+=s)<0&&(t=0):t>s&&(t=s),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUIntLE=function(e,t,s){e>>>=0,t>>>=0,s||_(e,t,this.length);for(var r=this[e],n=1,i=0;++i<t&&(n*=256);)r+=this[e+i]*n;return r},o.prototype.readUIntBE=function(e,t,s){e>>>=0,t>>>=0,s||_(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},o.prototype.readUInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,s){e>>>=0,t>>>=0,s||_(e,t,this.length);for(var r=this[e],n=1,i=0;++i<t&&(n*=256);)r+=this[e+i]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,s){e>>>=0,t>>>=0,s||_(e,t,this.length);for(var r=t,n=1,i=this[e+--r];r>0&&(n*=256);)i+=this[e+--r]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return(e>>>=0,t||_(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||_(e,2,this.length);var s=this[e]|this[e+1]<<8;return 32768&s?0xffff0000|s:s},o.prototype.readInt16BE=function(e,t){e>>>=0,t||_(e,2,this.length);var s=this[e+1]|this[e]<<8;return 32768&s?0xffff0000|s:s},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||_(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||_(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||_(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||_(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,s,r){if(e*=1,t>>>=0,s>>>=0,!r){var n=Math.pow(2,8*s)-1;b(this,e,t,s,n,0)}var i=1,a=0;for(this[t]=255&e;++a<s&&(i*=256);)this[t+a]=e/i&255;return t+s},o.prototype.writeUIntBE=function(e,t,s,r){if(e*=1,t>>>=0,s>>>=0,!r){var n=Math.pow(2,8*s)-1;b(this,e,t,s,n,0)}var i=s-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+s},o.prototype.writeUInt8=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,s,r){if(e*=1,t>>>=0,!r){var n=Math.pow(2,8*s-1);b(this,e,t,s,n-1,-n)}var i=0,a=1,o=0;for(this[t]=255&e;++i<s&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+s},o.prototype.writeIntBE=function(e,t,s,r){if(e*=1,t>>>=0,!r){var n=Math.pow(2,8*s-1);b(this,e,t,s,n-1,-n)}var i=s-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+s},o.prototype.writeInt8=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,s){return e*=1,t>>>=0,s||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,s){return k(this,e,t,!0,s)},o.prototype.writeFloatBE=function(e,t,s){return k(this,e,t,!1,s)},o.prototype.writeDoubleLE=function(e,t,s){return S(this,e,t,!0,s)},o.prototype.writeDoubleBE=function(e,t,s){return S(this,e,t,!1,s)},o.prototype.copy=function(e,t,s,r){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(s||(s=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<s&&(r=s),r===s||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-s&&(r=e.length-t+s);var n=r-s;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,s,r);else if(this===e&&s<t&&t<r)for(var i=n-1;i>=0;--i)e[i+t]=this[i+s];else Uint8Array.prototype.set.call(e,this.subarray(s,r),t);return n},o.prototype.fill=function(e,t,s,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,s=this.length):"string"==typeof s&&(r=s,s=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var n,i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<s)throw RangeError("Out of range index");if(s<=t)return this;if(t>>>=0,s=void 0===s?this.length:s>>>0,e||(e=0),"number"==typeof e)for(n=t;n<s;++n)this[n]=e;else{var a=o.isBuffer(e)?e:o.from(e,r),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<s-t;++n)this[n+t]=a[n%l]}return this};var x=/[^+/0-9A-Za-z-_]/g;function E(e,t){t=t||1/0;for(var s,r=e.length,n=null,i=[],a=0;a<r;++a){if((s=e.charCodeAt(a))>55295&&s<57344){if(!n){if(s>56319||a+1===r){(t-=3)>-1&&i.push(239,191,189);continue}n=s;continue}if(s<56320){(t-=3)>-1&&i.push(239,191,189),n=s;continue}s=(n-55296<<10|s-56320)+65536}else n&&(t-=3)>-1&&i.push(239,191,189);if(n=null,s<128){if((t-=1)<0)break;i.push(s)}else if(s<2048){if((t-=2)<0)break;i.push(s>>6|192,63&s|128)}else if(s<65536){if((t-=3)<0)break;i.push(s>>12|224,s>>6&63|128,63&s|128)}else if(s<1114112){if((t-=4)<0)break;i.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}else throw Error("Invalid code point")}return i}function A(e){for(var t=[],s=0;s<e.length;++s)t.push(255&e.charCodeAt(s));return t}function T(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,s,r){for(var n=0;n<r&&!(n+s>=t.length)&&!(n>=e.length);++n)t[n+s]=e[n];return n}function O(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var $=function(){for(var e="0123456789abcdef",t=Array(256),s=0;s<16;++s)for(var r=16*s,n=0;n<16;++n)t[r+n]=e[s]+e[n];return t}()},783:function(e,t){t.read=function(e,t,s,r,n){var i,a,o=8*n-r-1,l=(1<<o)-1,h=l>>1,c=-7,u=s?n-1:0,d=s?-1:1,f=e[t+u];for(u+=d,i=f&(1<<-c)-1,f>>=-c,c+=o;c>0;i=256*i+e[t+u],u+=d,c-=8);for(a=i&(1<<-c)-1,i>>=-c,c+=r;c>0;a=256*a+e[t+u],u+=d,c-=8);if(0===i)i=1-h;else{if(i===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),i-=h}return(f?-1:1)*a*Math.pow(2,i-r)},t.write=function(e,t,s,r,n,i){var a,o,l,h=8*i-n-1,c=(1<<h)-1,u=c>>1,d=5960464477539062e-23*(23===n),f=r?0:i-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+u>=1?t+=d/l:t+=d*Math.pow(2,1-u),t*l>=2&&(a++,l/=2),a+u>=c?(o=0,a=c):a+u>=1?(o=(t*l-1)*Math.pow(2,n),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),a=0));n>=8;e[s+f]=255&o,f+=p,o/=256,n-=8);for(a=a<<n|o,h+=n;h>0;e[s+f]=255&a,f+=p,a/=256,h-=8);e[s+f-p]|=128*g}}},s={};function r(e){var n=s[e];if(void 0!==n)return n.exports;var i=s[e]={exports:{}},a=!0;try{t[e](i,i.exports,r),a=!1}finally{a&&delete s[e]}return i.exports}r.ab="//",e.exports=r(72)}()},9936:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(s(5068)),i=r(s(3280)),a=s(5171);class o{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},a.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){let t=new URL(`${this.url}/${e}`);return new n.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new o(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:n}={}){let a,o,l=new URL(`${this.url}/rpc/${e}`);s||r?(a=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a="POST",o=t);let h=Object.assign({},this.headers);return n&&(h.Prefer=`count=${n}`),new i.default({method:a,url:l,headers:h,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}t.default=o}}]);